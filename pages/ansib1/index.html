<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ansible 运维自动化 | CloudNative Operations</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="专注于云原生运维技术分享,Kubernetes,Prometheus，istio,envoy等技术文章">
    <meta name="CloudNative Operations" content="专注于云原生运维技术分享,致敬每个爱学习的你">
    <meta name="baidu-site-verification" content="code-UYHaqAD5D2">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.546f0649.css" as="style"><link rel="preload" href="/assets/js/app.519980b4.js" as="script"><link rel="preload" href="/assets/js/2.f3cfc96e.js" as="script"><link rel="preload" href="/assets/js/19.fce8cb8d.js" as="script"><link rel="prefetch" href="/assets/js/10.131e8578.js"><link rel="prefetch" href="/assets/js/11.d46d63fe.js"><link rel="prefetch" href="/assets/js/12.dea116c0.js"><link rel="prefetch" href="/assets/js/13.5d65f72d.js"><link rel="prefetch" href="/assets/js/14.cfc40d4c.js"><link rel="prefetch" href="/assets/js/15.a8f19ee2.js"><link rel="prefetch" href="/assets/js/16.33a07abe.js"><link rel="prefetch" href="/assets/js/17.f4c7d679.js"><link rel="prefetch" href="/assets/js/18.d8fc7faa.js"><link rel="prefetch" href="/assets/js/20.e49ff1df.js"><link rel="prefetch" href="/assets/js/21.374ea34b.js"><link rel="prefetch" href="/assets/js/22.85187cad.js"><link rel="prefetch" href="/assets/js/23.dcf8d006.js"><link rel="prefetch" href="/assets/js/24.d423cbe2.js"><link rel="prefetch" href="/assets/js/25.f7f962ca.js"><link rel="prefetch" href="/assets/js/26.d33e81c4.js"><link rel="prefetch" href="/assets/js/27.c34c8dbb.js"><link rel="prefetch" href="/assets/js/28.13891ebf.js"><link rel="prefetch" href="/assets/js/29.ec2161e1.js"><link rel="prefetch" href="/assets/js/3.c40e1967.js"><link rel="prefetch" href="/assets/js/30.1b46a9c1.js"><link rel="prefetch" href="/assets/js/31.0abb90e4.js"><link rel="prefetch" href="/assets/js/32.8cde09e7.js"><link rel="prefetch" href="/assets/js/33.69e0ede4.js"><link rel="prefetch" href="/assets/js/34.fb97b72f.js"><link rel="prefetch" href="/assets/js/4.523f8496.js"><link rel="prefetch" href="/assets/js/5.ab2f819c.js"><link rel="prefetch" href="/assets/js/6.40e3ffa9.js"><link rel="prefetch" href="/assets/js/7.0b585a2a.js"><link rel="prefetch" href="/assets/js/8.198595ac.js"><link rel="prefetch" href="/assets/js/9.f022d6ba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.546f0649.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/EB-logo.png" alt="CloudNative Operations" class="logo"> <span class="site-name can-hide">CloudNative Operations</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/books/" class="nav-link">书籍</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div> <a href="https://github.com/cf1998/kubernetes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://kubesre.com/img/EB-logo.png"> <div class="blogger-info"><h3>船长</h3> <span>CloudNative Operations</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/books/" class="nav-link">书籍</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div> <a href="https://github.com/cf1998/kubernetes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ansible 运维自动化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ansib1/#ansible-概述" class="sidebar-link">Ansible 概述</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/ansib1/#主机清单" class="sidebar-link">主机清单</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/ansib1/#命令行使用" class="sidebar-link">命令行使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ansib1/#连接远程主机认证" class="sidebar-link">连接远程主机认证</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#常用选项" class="sidebar-link">常用选项</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#命令行使用-2" class="sidebar-link">命令行使用</a></li></ul></li><li><a href="/pages/ansib1/#常用模块" class="sidebar-link">常用模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ansib1/#shell" class="sidebar-link">shell</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#copy" class="sidebar-link">copy</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#file" class="sidebar-link">file</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#yum" class="sidebar-link">yum</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#service-systemd" class="sidebar-link">service/systemd</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#unarchive" class="sidebar-link">unarchive</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#debug" class="sidebar-link">debug</a></li></ul></li><li><a href="/pages/ansib1/#变量" class="sidebar-link">变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ansib1/#主机变量与组变量" class="sidebar-link">主机变量与组变量</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#register变量" class="sidebar-link">Register变量</a></li></ul></li><li><a href="/pages/ansib1/#playbook" class="sidebar-link">Playbook</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ansib1/#主机和用户" class="sidebar-link">主机和用户</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#定义变量" class="sidebar-link">定义变量</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#任务列表" class="sidebar-link">任务列表</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#语法检查与调试" class="sidebar-link">语法检查与调试</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#任务控制" class="sidebar-link">任务控制</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#流程控制" class="sidebar-link">流程控制</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#模板" class="sidebar-link">模板</a></li></ul></li><li><a href="/pages/ansib1/#roles" class="sidebar-link">Roles</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ansib1/#定义roles" class="sidebar-link">定义Roles</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#使用角色" class="sidebar-link">使用角色</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#角色控制" class="sidebar-link">角色控制</a></li><li class="sidebar-sub-header"><a href="/pages/ansib1/#定义变量-2" class="sidebar-link">定义变量</a></li></ul></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-9354336437522810"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><!----> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>船长</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-11-24</a></div> <div title="分类" class="date iconfont icon-wenjian" data-v-1cd794fe><a href="/categories/?category=Linux" data-v-1cd794fe>Linux </a></div></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          Ansible 运维自动化
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-9354336437522810"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="ansible-概述"><a href="#ansible-概述" class="header-anchor">#</a> Ansible 概述</h2> <p>Ansbile是一种IT自动化工具。它可以配置系统，部署软件以及协调更高级的IT任务，列如持续部署，滚动更新。</p> <p>Ansible 适用于管理企业IT基础设施，从具有少数主机的小规模到数千个实例的企业环境。Ansible 也是一种简单的自动化语言，可以完美地描述IT应用程序基础结构。

具备以下三个特点：</p> <ul><li>简单：减少学习成本</li> <li>强大：协调应用程序生命周期</li> <li>无代理：可预测，可靠和安全</li></ul> <p>使用文档：https://releases.ansible.com/ansible/</p> <p>安装 Ansible：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment">#  yum install epel-release</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment">#  yum install ansible -y</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://kubesre.com/img/ansible.png" alt=""></p> <ul><li>Inventory：Ansible管理的主机信息，包括IP地址、SSH端口、账号、密码等</li> <li>Modules：任务均有模块完成，也可以自定义模块，例如经常用的脚本。</li> <li>Plugins：使用插件增加Ansible核心功能，自身提供了很多插件，也可以自定义插件。例如connection插件，用于连接目标主机。</li> <li>Playbooks：“剧本”，模块化定义一系列任务，供外部统一调用。Ansible核心功能。</li></ul> <h2 id="主机清单"><a href="#主机清单" class="header-anchor">#</a> 主机清单</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/ansible/hosts </span>
<span class="token punctuation">[</span>webservers<span class="token punctuation">]</span>
<span class="token number">192.168</span>.1.101
<span class="token number">192.168</span>.1.102
<span class="token number">192.168</span>.1.103
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="命令行使用"><a href="#命令行使用" class="header-anchor">#</a> 命令行使用</h2> <h3 id="连接远程主机认证"><a href="#连接远程主机认证" class="header-anchor">#</a> 连接远程主机认证</h3> <p>SSH密码认证：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/ansible/hosts </span>
<span class="token punctuation">[</span>webservers<span class="token punctuation">]</span>
<span class="token number">192.168</span>.1.101 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root <span class="token assign-left variable">ansible_ssh_pass</span><span class="token operator">=</span>’Admin@1234’
<span class="token number">192.168</span>.1.102 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root <span class="token assign-left variable">ansible_ssh_pass</span><span class="token operator">=</span>’Admin@1234’
<span class="token number">192.168</span>.1.103 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root <span class="token assign-left variable">ansible_ssh_pass</span><span class="token operator">=</span>’Admin@1234’
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>SSH密钥对认证：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/ansible/hosts </span>
<span class="token punctuation">[</span>webservers<span class="token punctuation">]</span>
<span class="token number">192.168</span>.1.101 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root <span class="token assign-left variable">ansible_ssh_key</span><span class="token operator">=</span>/root/.ssh/id_rsa 
<span class="token number">192.168</span>.1.102 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root ’
<span class="token number">192.168</span>.1.103 <span class="token assign-left variable">ansible_ssh_user</span><span class="token operator">=</span>root 

也可以在配置文件中指定：
<span class="token punctuation">[</span>defaults<span class="token punctuation">]</span>
private_key_file <span class="token operator">=</span> /root/.ssh/id_rsa  <span class="token comment"># 默认路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="常用选项"><a href="#常用选项" class="header-anchor">#</a> 常用选项</h3> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>-C, --check</td> <td>运行检查，不执行任何操作</td></tr> <tr><td>-e EXTRA_VARS,--extra-vars=EXTRA_VARS</td> <td>设置附加变量 key=value</td></tr> <tr><td>-u REMOTE_USER, --user=REMOTE_USER</td> <td>SSH连接用户，默认None</td></tr> <tr><td>-k, --ask-pass</td> <td>SSH连接用户密码</td></tr> <tr><td>-b, --become</td> <td>提权，默认root</td></tr> <tr><td>-K, --ask-become-pass</td> <td>提权密码</td></tr></tbody></table> <h3 id="命令行使用-2"><a href="#命令行使用-2" class="header-anchor">#</a> 命令行使用</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m ping</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false, 
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false, 
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> false, 
    <span class="token string">&quot;ping&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;pong&quot;</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a &quot;ls /root&quot; -u root -k</span>
SSH password: 
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
etcd-v3.4.13-linux-amd64
etcd-v3.4.13-linux-amd64.tar.gz
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
ca.cer
cfssl-certinfo_linux-amd64
cfssljson_linux-amd64
cfssl_linux-amd64
components.yaml
config.yaml
istio-1.11.4
istio-1.11.4-linux-amd64.tar.gz
transit.nolpay.ae.cer
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h2 id="常用模块"><a href="#常用模块" class="header-anchor">#</a> 常用模块</h2> <p>ansible-doc –l 查看所有模块</p> <p>ansible-doc –s copy 查看模块文档</p> <h3 id="shell"><a href="#shell" class="header-anchor">#</a> shell</h3> <p>在目标主机执行shell命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a &quot;chdir='/var/log/' ls -l | grep log&quot;      </span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-------. <span class="token number">1</span> root root       <span class="token number">0</span> Nov  <span class="token number">4</span> 03:17 boot.log
-rw-------. <span class="token number">1</span> root root    <span class="token number">9219</span> Nov  <span class="token number">4</span> 03:17 boot.log-20211104
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">292000</span> Nov <span class="token number">24</span> <span class="token number">10</span>:59 lastlog
-rw-------. <span class="token number">1</span> root root       <span class="token number">0</span> Nov <span class="token number">21</span> 03:16 maillog
-rw-------. <span class="token number">1</span> root root     <span class="token number">198</span> Mar <span class="token number">31</span>  <span class="token number">2021</span> maillog-20211107
-rw-------. <span class="token number">1</span> root root       <span class="token number">0</span> Nov  <span class="token number">7</span> 03:43 maillog-20211114
-rw-------. <span class="token number">1</span> root root       <span class="token number">0</span> Nov <span class="token number">14</span> 03:32 maillog-20211121
-rw-------. <span class="token number">1</span> root root       <span class="token number">0</span> Mar <span class="token number">31</span>  <span class="token number">2021</span> tallylog
-rw-------. <span class="token number">1</span> root root    <span class="token number">4480</span> Nov  <span class="token number">4</span> <span class="token number">14</span>:21 yum.log
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-------. <span class="token number">1</span> root root       <span class="token number">0</span> Nov  <span class="token number">5</span> 03:45 boot.log
-rw-------. <span class="token number">1</span> root root    <span class="token number">9305</span> Nov  <span class="token number">4</span> 03:14 boot.log-20211104
-rw-------  <span class="token number">1</span> root root    <span class="token number">8383</span> Nov  <span class="token number">5</span> 03:45 boot.log-20211105
-rw-r--r--. <span class="token number">1</span> root root  <span class="token number">292000</span> Nov <span class="token number">24</span> <span class="token number">10</span>:59 lastlog
-rw-------  <span class="token number">1</span> root root       <span class="token number">0</span> Nov <span class="token number">21</span> 03:40 maillog
-rw-------. <span class="token number">1</span> root root     <span class="token number">424</span> Nov  <span class="token number">4</span> <span class="token number">14</span>:27 maillog-20211107
-rw-------  <span class="token number">1</span> root root       <span class="token number">0</span> Nov  <span class="token number">7</span> 03:21 maillog-20211114
-rw-------  <span class="token number">1</span> root root       <span class="token number">0</span> Nov <span class="token number">14</span> 03:49 maillog-20211121
-rw-------. <span class="token number">1</span> root root       <span class="token number">0</span> Mar <span class="token number">31</span>  <span class="token number">2021</span> tallylog
-rw-------. <span class="token number">1</span> root root    <span class="token number">4480</span> Nov  <span class="token number">4</span> <span class="token number">14</span>:21 yum.log
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-------.  <span class="token number">1</span> root root        <span class="token number">0</span> Nov  <span class="token number">5</span> 03:12 boot.log
-rw-------.  <span class="token number">1</span> root root     <span class="token number">9241</span> Nov  <span class="token number">4</span> 03:08 boot.log-20211104
-rw-------   <span class="token number">1</span> root root     <span class="token number">8294</span> Nov  <span class="token number">5</span> 03:12 boot.log-20211105
-rw-r--r--.  <span class="token number">1</span> root root   <span class="token number">292000</span> Nov <span class="token number">24</span> <span class="token number">10</span>:59 lastlog
-rw-------   <span class="token number">1</span> root root        <span class="token number">0</span> Nov <span class="token number">21</span> 03:43 maillog
-rw-------.  <span class="token number">1</span> root root      <span class="token number">424</span> Nov  <span class="token number">4</span> <span class="token number">15</span>:41 maillog-20211107
-rw-------   <span class="token number">1</span> root root        <span class="token number">0</span> Nov  <span class="token number">7</span> 03:31 maillog-20211114
-rw-------   <span class="token number">1</span> root root        <span class="token number">0</span> Nov <span class="token number">14</span> 03:25 maillog-20211121
-rw-------.  <span class="token number">1</span> root root        <span class="token number">0</span> Mar <span class="token number">31</span>  <span class="token number">2021</span> tallylog
-rw-------.  <span class="token number">1</span> root root     <span class="token number">7792</span> Nov  <span class="token number">4</span> <span class="token number">14</span>:43 yum.log


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>参数说明：</p> <ul><li><p><strong>chdir参数 :</strong> 此参数的作用就是指定一个目录，在执行对应的命令之前，会先进入到 chdir 参数指定的目录中</p></li> <li><p>**executable参数：**默认情况下，shell 模块会调用远程主机中的 /bin/sh 去执行对应的命令，通常情况下，远程主机中的默认 shell 都是 bash。如果你想要使用其他类型的 shell 执行命令，则可以使用此参数指定某种类型的 shell 去执行对应的命令。指定 shell 文件时，需要使用绝对路径</p></li> <li><p>**removes参数 ：**使用此参数指定一个文件，当指定的文件不存在时，就不执行对应命令</p></li> <li><p>**creates参数 ：**使用此参数指定一个文件，当指定的文件存在时，就不执行对应命令</p></li> <li><p>**free_form参数 ：**必须参数，指定需要远程执行的命令，但是并没有具体的一个参数名叫<code>free_form</code>，</p></li></ul> <h3 id="copy"><a href="#copy" class="header-anchor">#</a> copy</h3> <p>将文件复制到远程主机</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m copy -a &quot;src=ArmsAgent.tar.gz dest=/tmp/&quot;</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0b0fed4f40a4bf83fe174309e17273cdeedb9c2e&quot;</span>, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;08dcb6dbe63eeeb42628dfe9cc14e4e9&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">46325347</span>, 
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637724228.32-26808-199044113552898/source&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0b0fed4f40a4bf83fe174309e17273cdeedb9c2e&quot;</span>, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;08dcb6dbe63eeeb42628dfe9cc14e4e9&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">46325347</span>, 
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637724228.61-26806-205389838720285/source&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0b0fed4f40a4bf83fe174309e17273cdeedb9c2e&quot;</span>, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;md5sum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;08dcb6dbe63eeeb42628dfe9cc14e4e9&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">46325347</span>, 
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637724228.5-26804-266077367101765/source&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>


<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m copy -a &quot;src=ArmsAgent.tar.gz dest=/tmp/ owner=root group=root mode=777&quot;</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0b0fed4f40a4bf83fe174309e17273cdeedb9c2e&quot;</span>, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:admin_home_t:s0&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">46325347</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0b0fed4f40a4bf83fe174309e17273cdeedb9c2e&quot;</span>, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">46325347</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;checksum&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0b0fed4f40a4bf83fe174309e17273cdeedb9c2e&quot;</span>, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/ArmsAgent.tar.gz&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">46325347</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div><p>参数说明：</p> <ul><li>**src参数 ：**用于指定需要copy的文件或目录</li> <li>**dest参数 ：**用于指定文件将被拷贝到远程主机的哪个目录中，dest为必须参数</li> <li>**content参数 ：**当不使用src指定拷贝的文件时，可以使用content直接指定文件内容，src与content两个参数必有其一，否则会报错</li> <li><strong>force参数 :</strong> 当远程主机的目标路径中已经存在同名文件，并且与ansible主机中的文件内容不同时，是否强制覆盖，可选值有yes和no，默认值为yes，表示覆盖，如果设置为no，则不会执行覆盖拷贝操作，远程主机中的文件保持不变</li> <li><strong>backup参数 :</strong> 当远程主机的目标路径中已经存在同名文件，并且与ansible主机中的文件内容不同时，是否对远程主机的文件进行备份，可选值有yes和no，当设置为yes时，会先备份远程主机中的文件，然后再将ansible主机中的文件拷贝到远程主机</li> <li><strong>owner参数 :</strong> 指定文件拷贝到远程主机后的属主，但是远程主机上必须有对应的用户，否则会报错</li> <li><strong>group参数 :</strong> 指定文件拷贝到远程主机后的属组，但是远程主机上必须有对应的组，否则会报错</li> <li><strong>mode参数 :</strong> 指定文件拷贝到远程主机后的权限，如果你想将权限设置为”<code>rw-r--r--</code>“，则可以使用<code>mode=0644</code>表示，如果你想要在user对应的权限位上添加执行权限，则可以使用<code>mode=u+x</code>表示</li></ul> <h3 id="file"><a href="#file" class="header-anchor">#</a> file</h3> <p>管理文件和文件属性</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 创建文件</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file -a &quot;path=/tmp/kubesre state=touch&quot;</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/kubesre&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/kubesre&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:user_tmp_t:s0&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/kubesre&quot;</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0644&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a &quot;ls -l /tmp/kubesre&quot;</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">0</span> Nov <span class="token number">24</span> <span class="token number">11</span>:37 /tmp/kubesre
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Nov <span class="token number">24</span> <span class="token number">11</span>:37 /tmp/kubesre
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">0</span> Nov <span class="token number">24</span> <span class="token number">11</span>:37 /tmp/kubesre

<span class="token comment"># 创建目录</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file -a &quot;path=/tmp/test state=directory&quot;</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0755&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/test&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0755&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/test&quot;</span>, 
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:user_tmp_t:s0&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0755&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/test&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">6</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a &quot;ls -l /tmp&quot;      </span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
total <span class="token number">45240</span>
drwx------. <span class="token number">2</span> root root       <span class="token number">41</span> Nov <span class="token number">24</span> <span class="token number">11</span>:48 ansible_command_payload_ceyqUR
-rwxrwxrwx. <span class="token number">1</span> root root <span class="token number">46325347</span> Nov <span class="token number">24</span> <span class="token number">11</span>:23 ArmsAgent.tar.gz
-rw-r--r--. <span class="token number">1</span> root root        <span class="token number">0</span> Nov <span class="token number">24</span> <span class="token number">11</span>:37 kubesre
drwxr-xr-x. <span class="token number">2</span> root root        <span class="token number">6</span> Nov <span class="token number">24</span> <span class="token number">11</span>:48 <span class="token builtin class-name">test</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
total <span class="token number">45240</span>
drwx------ <span class="token number">2</span> root root       <span class="token number">41</span> Nov <span class="token number">24</span> <span class="token number">11</span>:48 ansible_command_payload_IyoZG8
-rwxrwxrwx <span class="token number">1</span> root root <span class="token number">46325347</span> Nov <span class="token number">24</span> <span class="token number">11</span>:23 ArmsAgent.tar.gz
-rw-r--r-- <span class="token number">1</span> root root        <span class="token number">0</span> Nov <span class="token number">24</span> <span class="token number">11</span>:37 kubesre
drwxr-xr-x <span class="token number">2</span> root root        <span class="token number">6</span> Nov <span class="token number">24</span> <span class="token number">11</span>:48 <span class="token builtin class-name">test</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token operator">&gt;&gt;</span>
total <span class="token number">45240</span>
drwx------ <span class="token number">2</span> root root       <span class="token number">41</span> Nov <span class="token number">24</span> <span class="token number">11</span>:48 ansible_command_payload_guMhZe
-rwxrwxrwx <span class="token number">1</span> root root <span class="token number">46325347</span> Nov <span class="token number">24</span> <span class="token number">11</span>:23 ArmsAgent.tar.gz
-rw-r--r-- <span class="token number">1</span> root root        <span class="token number">0</span> Nov <span class="token number">24</span> <span class="token number">11</span>:37 kubesre
drwxr-xr-x <span class="token number">2</span> root root        <span class="token number">6</span> Nov <span class="token number">24</span> <span class="token number">11</span>:48 <span class="token builtin class-name">test</span>

<span class="token comment"># 删除目录</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file -a &quot;path=/tmp/test state=absent&quot;</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/test&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;absent&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/test&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;absent&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/test&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;absent&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 修改属性</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file -a &quot;path=/tmp/kubesre mode=777&quot;</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/kubesre&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/kubesre&quot;</span>, 
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;unconfined_u:object_r:user_tmp_t:s0&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/kubesre&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;file&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br></div></div><p>参数说明：</p> <ul><li><p><strong>path</strong>：要操作的文件或目录</p></li> <li><p><strong>state</strong>：此参数非常灵活，此参数对应的值需要根据情况设定，比如，当我们需要在远程主机中创建一个目录的时候，我们需要使用path参数指定对应的目录路径，假设，我想要在远程主机上创建/testdir/a/b目录，那么我则需要设置path=/testdir/a/b，但是，我们无法从&quot;/testdir/a/b&quot;这个路径看出b是一个文件还是一个目录，ansible也同样无法单单从一个字符串就知道你要创建文件还是目录，所以，我们需要通过state参数进行说明，当我们想要创建的/testdir/a/b是一个目录时，需要将state的值设置为directory，&quot;directory&quot;为目录之意，当它与path结合，ansible就能知道我们要操作的目标是一个目录，同理，当我们想要操作的/testdir/a/b是一个文件时，则需要将state的值设置为touch，当我们想要创建软链接文件时，需将state设置为link，想要创建硬链接文件时，需要将state设置为hard，当我们想要删除一个文件时（删除时不用区分目标是文件、目录、还是链接），则需要将state的值设置为absent，&quot;absent&quot;为缺席之意，当我们想让操作的目标&quot;缺席&quot;时，就表示我们想要删除目标</p></li> <li><p><strong>src</strong>：当state设置为link或者hard时，表示我们想要创建一个软链或者硬链，所以，我们必须指明软链或硬链链接的哪个文件，通过src参数即可指定链接源。</p></li> <li><p><strong>force</strong> :  当state=link的时候，可配合此参数强制创建链接文件，当force=yes时，表示强制创建链接文件，不过强制创建链接文件分为两种情况，情况一：当你要创建的链接文件指向的源文件并不存在时，使用此参数，可以先强制创建出链接文件。情况二：当你要创建链接文件的目录中已经存在与链接文件同名的文件时，将force设置为yes，回将同名文件覆盖为链接文件，相当于删除同名文件，创建链接文件。情况三：当你要创建链接文件的目录中已经存在与链接文件同名的文件，并且链接文件指向的源文件也不存在，这时会强制替换同名文件为链接文件。</p></li> <li><p><strong>owner</strong> ：用于指定被操作文件的属主，属主对应的用户必须在远程主机中存在，否则会报错。</p></li> <li><p><strong>group</strong> ：用于指定被操作文件的属组，属组对应的组必须在远程主机中存在，否则会报错。</p></li> <li><p><strong>mode</strong>：用于指定被操作文件的权限，比如，如果想要将文件权限设置为&quot;rw-r-x---&quot;，则可以使用mode=650进行设置，或者使用mode=0650，效果也是相同的，如果你想要设置特殊权限，比如为二进制文件设置suid，则可以使用mode=4700，很方便吧。</p></li> <li><p><strong>recurse</strong>：当要操作的文件为目录，将recurse设置为yes，可以递归的修改目录中文件的属性。</p></li> <li><p>**absent：**表示卸载</p></li></ul> <h3 id="yum"><a href="#yum" class="header-anchor">#</a> yum</h3> <p>软件包管理</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 安装Nginx</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum -a &quot;name=http://nginx.org/packages/rhel/7/x86_64/RPMS/nginx-1.16.1-1.el7.ngx.x86_64.rpm state=present&quot;</span>

<span class="token comment"># 卸载Nginx</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum -a &quot;name=nginx state=absent&quot;</span>

<span class="token comment"># 更新所有包</span>
<span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum -a &quot;name='*' state=latest&quot; </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="service-systemd"><a href="#service-systemd" class="header-anchor">#</a> service/systemd</h3> <p>管理服务</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m systemd -a &quot;name=nginx state=restarted enabled=yes&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="unarchive"><a href="#unarchive" class="header-anchor">#</a> unarchive</h3> <p>解压到远程机器指定目录</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@ops ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m unarchive -a &quot;src=ArmsAgent.tar.gz dest=/tmp&quot;</span>
<span class="token number">192.168</span>.1.103 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp&quot;</span>, 
    <span class="token string">&quot;extract_results&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;cmd&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;/usr/bin/gtar&quot;</span>, 
            <span class="token string">&quot;--extract&quot;</span>, 
            <span class="token string">&quot;-C&quot;</span>, 
            <span class="token string">&quot;/tmp&quot;</span>, 
            <span class="token string">&quot;-z&quot;</span>, 
            <span class="token string">&quot;-f&quot;</span>, 
            <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637734297.88-28601-94567791333261/source&quot;</span>
        <span class="token punctuation">]</span>, 
        <span class="token string">&quot;err&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>, 
        <span class="token string">&quot;out&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>, 
        <span class="token string">&quot;rc&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;handler&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;TgzArchive&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;01777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">240</span>, 
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637734297.88-28601-94567791333261/source&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.102 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp&quot;</span>, 
    <span class="token string">&quot;extract_results&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;cmd&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;/usr/bin/gtar&quot;</span>, 
            <span class="token string">&quot;--extract&quot;</span>, 
            <span class="token string">&quot;-C&quot;</span>, 
            <span class="token string">&quot;/tmp&quot;</span>, 
            <span class="token string">&quot;-z&quot;</span>, 
            <span class="token string">&quot;-f&quot;</span>, 
            <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637734298.15-28599-160150628668658/source&quot;</span>
        <span class="token punctuation">]</span>, 
        <span class="token string">&quot;err&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>, 
        <span class="token string">&quot;out&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>, 
        <span class="token string">&quot;rc&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;handler&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;TgzArchive&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;01777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;secontext&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;system_u:object_r:tmp_t:s0&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">240</span>, 
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637734298.15-28599-160150628668658/source&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token number">192.168</span>.1.101 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ansible_facts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;discovered_interpreter_python&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/bin/python&quot;</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;changed&quot;</span><span class="token builtin class-name">:</span> true, 
    <span class="token string">&quot;dest&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp&quot;</span>, 
    <span class="token string">&quot;extract_results&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;cmd&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;/usr/bin/gtar&quot;</span>, 
            <span class="token string">&quot;--extract&quot;</span>, 
            <span class="token string">&quot;-C&quot;</span>, 
            <span class="token string">&quot;/tmp&quot;</span>, 
            <span class="token string">&quot;-z&quot;</span>, 
            <span class="token string">&quot;-f&quot;</span>, 
            <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637734298.01-28597-226262773743899/source&quot;</span>
        <span class="token punctuation">]</span>, 
        <span class="token string">&quot;err&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>, 
        <span class="token string">&quot;out&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>, 
        <span class="token string">&quot;rc&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>, 
    <span class="token string">&quot;gid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;handler&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;TgzArchive&quot;</span>, 
    <span class="token string">&quot;mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;01777&quot;</span>, 
    <span class="token string">&quot;owner&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, 
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">240</span>, 
    <span class="token string">&quot;src&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/.ansible/tmp/ansible-tmp-1637734298.01-28597-226262773743899/source&quot;</span>, 
    <span class="token string">&quot;state&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;directory&quot;</span>, 
    <span class="token string">&quot;uid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><h3 id="debug"><a href="#debug" class="header-anchor">#</a> debug</h3> <p>执行过程中打印语句</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">debug</span><span class="token punctuation">:</span>
    <span class="token key atrule">msg</span><span class="token punctuation">:</span> System <span class="token punctuation">{</span><span class="token punctuation">{</span> inventory_hostname <span class="token punctuation">}</span><span class="token punctuation">}</span> has uuid <span class="token punctuation">{</span><span class="token punctuation">{</span> ansible_product_uuid <span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 显示主机已知的所有变量
  <span class="token key atrule">debug</span><span class="token punctuation">:</span>
    <span class="token key atrule">var</span><span class="token punctuation">:</span> hostvars<span class="token punctuation">[</span>inventory_hostname<span class="token punctuation">]</span>
    <span class="token key atrule">verbosity</span><span class="token punctuation">:</span> <span class="token number">4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="变量"><a href="#变量" class="header-anchor">#</a> 变量</h2> <p>变量是应用于多个主机的便捷方式，际在主机执行之前，变量会对每个主机添加，然后在执行中引用。</p> <h3 id="主机变量与组变量"><a href="#主机变量与组变量" class="header-anchor">#</a> 主机变量与组变量</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>webservers<span class="token punctuation">]</span>  <span class="token comment"># 主机变量</span>
<span class="token number">192.168</span>.1.101 <span class="token assign-left variable">hostname</span><span class="token operator">=</span>web1
<span class="token number">192.168</span>.1.102 <span class="token assign-left variable">hostname</span><span class="token operator">=</span>web2
<span class="token number">192.168</span>.1.103 <span class="token assign-left variable">hostname</span><span class="token operator">=</span>web3

<span class="token punctuation">[</span>webservers:vars<span class="token punctuation">]</span>   <span class="token comment"># 组变量</span>
<span class="token assign-left variable">group</span><span class="token operator">=</span>webservers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="register变量"><a href="#register变量" class="header-anchor">#</a> Register变量</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">shell</span><span class="token punctuation">:</span> /usr/bin/uptime
  <span class="token key atrule">register</span><span class="token punctuation">:</span> result
<span class="token punctuation">-</span> <span class="token key atrule">debug</span><span class="token punctuation">:</span>
    <span class="token key atrule">var</span><span class="token punctuation">:</span> result
    <span class="token key atrule">verbosity</span><span class="token punctuation">:</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="playbook"><a href="#playbook" class="header-anchor">#</a> Playbook</h2> <p>Playbooks是Ansible的配置，部署和编排语言。他们可以描述您希望在远程机器做哪些事或者描述IT流程中一系列步骤。使用易读的YAML格式组织Playbook文件。</p> <p>如果Ansible模块是您工作中的工具，那么Playbook就是您的使用说明书，而您的主机资产文件就是您的原材料。</p> <p>与adhoc任务执行模式相比，Playbooks使用ansible是一种完全不同的方式，并且功能特别强大。</p> <p>https://docs.ansible.com/ansible/latest/user_guide/pl</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webservers
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">server_name</span><span class="token punctuation">:</span> www.kubesre.com
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">gather_facts</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装nginx最新版
    <span class="token key atrule">yum</span><span class="token punctuation">:</span> pkg=nginx state=latest
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 写入nginx配置文件
    <span class="token key atrule">template</span><span class="token punctuation">:</span> src=/srv/httpd.j2 dest=/etc/nginx/nginx.conf
    <span class="token key atrule">notify</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> restart nginx
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 确保nginx正在运行
    <span class="token key atrule">service</span><span class="token punctuation">:</span> name=httpd state=started
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart nginx
      <span class="token key atrule">service</span><span class="token punctuation">:</span> name=nginx state=reloaded
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="主机和用户"><a href="#主机和用户" class="header-anchor">#</a> 主机和用户</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webservers
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">become</span><span class="token punctuation">:</span> yes
  <span class="token key atrule">become_user</span><span class="token punctuation">:</span> nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>解释说明：</p> <ul><li>become： 是否进行提权操作。如果需要，设置为<code>yes</code></li> <li>become_user：设置为具有所需特权的用户-您想要成为的用户，而不是您登录时使用的用户</li> <li>become_method ： 权限工具，如<code>sudo</code>，<code>su</code>，<code>pfexec</code>，<code>doas</code>，<code>pbrun</code>，<code>dzdo</code>，<code>ksu</code>，<code>runas</code>，<code>machinectl</code></li> <li>become_flags ： <code>play</code>或<code>task</code>级别上，允许为任务或角色使用特定的标志。一种常见的用法是，当<code>shell</code>设置为<code>no login</code>时，将用户更改为<code>nobody</code>。此指令是在Ansible 2.2中添加。</li></ul> <h3 id="定义变量"><a href="#定义变量" class="header-anchor">#</a> 定义变量</h3> <p>Ansible中的首选做法是不将变量存储在Inventory中。</p> <p>除了将变量直接存储在Inventory文件之外，主机和组变量还可以存储在相对于Inventory文件的单个文件中。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webservers
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">server_name</span><span class="token punctuation">:</span> www.kubesre.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="任务列表"><a href="#任务列表" class="header-anchor">#</a> 任务列表</h3> <p>每个play包含一系列任务。这些任务按照顺序执行，在play中，所有主机都会执行相同的任务指令。play目的是将选择的主机映射到任务。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装nginx最新版
    <span class="token key atrule">yum</span><span class="token punctuation">:</span> pkg=nginx state=latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="语法检查与调试"><a href="#语法检查与调试" class="header-anchor">#</a> 语法检查与调试</h3> <p>语法检查：ansible-playbook  --check  /path/to/playbook.yaml</p> <p>测试运行，不实际操作：ansible-playbook -C /path/to/playbook.yaml</p> <p>debug模块在执行期间打印语句，对于调试变量或表达式，而不必停止play。与'when：'指令一起调试更佳。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webserver
<span class="token key atrule">tasks</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">debug</span><span class="token punctuation">:</span>
<span class="token key atrule">msg</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>group_names<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">-</span> <span class="token key atrule">debug</span><span class="token punctuation">:</span>
<span class="token key atrule">msg</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>inventory_hostname<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">-</span> <span class="token key atrule">debug</span><span class="token punctuation">:</span>
<span class="token key atrule">msg</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>ansible_hostname<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="任务控制"><a href="#任务控制" class="header-anchor">#</a> 任务控制</h3> <p>如果你有一个大的剧本，那么能够在不运行整个剧本的情况下运行特定部分可能会很有用。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 安装nginx最新版
    <span class="token key atrule">yum</span><span class="token punctuation">:</span> pkg=nginx state=latest
    <span class="token key atrule">tags</span><span class="token punctuation">:</span> install
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 写入nginx配置文件
    <span class="token key atrule">template</span><span class="token punctuation">:</span> src=/srv/httpd.j2 dest=/etc/nginx/nginx.conf
    <span class="token key atrule">tags</span><span class="token punctuation">:</span> config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>ansible-playbook example.yml --tags <span class="token string">&quot;install&quot;</span>
ansible-playbook example.yml --tags <span class="token string">&quot;install,config&quot;</span>
ansible-playbook example.yml --skip-tags <span class="token string">&quot;install&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="流程控制"><a href="#流程控制" class="header-anchor">#</a> 流程控制</h3> <p>条件：</p> <div class="language-yam line-numbers-mode"><pre class="language-text"><code>tasks:
- name: 只在192.168.1.100运行任务
  debug: msg=&quot;{{ansible_default_ipv4.address}}&quot;
  when: ansible_default_ipv4.address == '192.168.1.100'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>循环：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">tasks</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> name： 批量创建用户
  <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present groups=wheel
  <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> testuser1
     <span class="token punctuation">-</span> testuser2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 解压
  <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=/tmp
  <span class="token key atrule">with_fileglob</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;*.txt&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>常用循环语句：</p> <table><thead><tr><th>语句</th> <th>描述</th></tr></thead> <tbody><tr><td>with_items</td> <td>标准循环</td></tr> <tr><td>with_fileglob</td> <td>遍历目录文件</td></tr> <tr><td>with_dict</td> <td>遍历字典</td></tr></tbody></table> <h3 id="模板"><a href="#模板" class="header-anchor">#</a> 模板</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>tasks:
  - name: 写入nginx配置文件
    template: <span class="token assign-left variable">src</span><span class="token operator">=</span>/srv/httpd.j2 <span class="token assign-left variable">dest</span><span class="token operator">=</span>/etc/nginx/nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>定义变量</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span>% set local_ip = inventory_hostname %<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>条件和循环</strong>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>% <span class="token builtin class-name">set</span> <span class="token assign-left variable">list</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'one'</span>, <span class="token string">'two'</span>, <span class="token string">'three'</span><span class="token punctuation">]</span> %<span class="token punctuation">}</span>
<span class="token punctuation">{</span>% <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> list %<span class="token punctuation">}</span>
	<span class="token punctuation">{</span>% <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">'two'</span> %<span class="token punctuation">}</span>
		-<span class="token operator">&gt;</span> two
	<span class="token punctuation">{</span>% <span class="token keyword">elif</span> loop.index <span class="token operator">==</span> <span class="token number">3</span> %<span class="token punctuation">}</span>
		-<span class="token operator">&gt;</span> <span class="token number">3</span>
	<span class="token punctuation">{</span>% <span class="token keyword">else</span> %<span class="token punctuation">}</span>
		<span class="token punctuation">{</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token punctuation">{</span>% endif %<span class="token punctuation">}</span>
<span class="token punctuation">{</span>% endfor %<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>例如：生成连接etcd字符串</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>% <span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> groups<span class="token punctuation">[</span><span class="token string">'etcd'</span><span class="token punctuation">]</span> %<span class="token punctuation">}</span>
	https://<span class="token punctuation">{</span><span class="token punctuation">{</span> hostvars<span class="token punctuation">[</span>host<span class="token punctuation">]</span>.inventory_hostname <span class="token punctuation">}</span><span class="token punctuation">}</span>:2379
	<span class="token punctuation">{</span>% <span class="token keyword">if</span> not loop.last %<span class="token punctuation">}</span>,<span class="token punctuation">{</span>% endif %<span class="token punctuation">}</span>
<span class="token punctuation">{</span>% endfor %<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>里面也可以用ansible的变量。</p> <h2 id="roles"><a href="#roles" class="header-anchor">#</a> Roles</h2> <p>Roles是基于已知文件结构自动加载某些变量文件，任务和处理程序的方法。按角色对内容进行分组，适合构建复杂的部署环境。</p> <h3 id="定义roles"><a href="#定义roles" class="header-anchor">#</a> 定义Roles</h3> <p>Roles目录结构：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>site.yml
webservers.yml
fooservers.yml
roles/
   common/
     tasks/
     handlers/
     files/
     templates/
     vars/
     defaults/
     meta/
   webservers/
     tasks/
     defaults/
     meta/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><code>tasks</code> -包含角色要执行的任务的主要列表。</li> <li><code>handlers</code> -包含处理程序，此角色甚至在此角色之外的任何地方都可以使用这些处理程序。</li> <li><code>defaults</code>-角色的默认变量</li> <li><code>vars</code>-角色的其他变量</li> <li><code>files</code> -包含可以通过此角色部署的文件。</li> <li><code>templates</code> -包含可以通过此角色部署的模板。</li> <li><code>meta</code>-为此角色定义一些元数据。请参阅下面的更多细节。</li></ul> <p>通常的做法是从<code>tasks/main.yml</code>文件中包含特定于平台的任务：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># roles/webservers/tasks/main.yml</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> added in 2.4<span class="token punctuation">,</span> previously you used 'include'
  <span class="token key atrule">import_tasks</span><span class="token punctuation">:</span> redhat.yml
  <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_facts<span class="token punctuation">[</span><span class="token string">'os_family'</span><span class="token punctuation">]</span><span class="token punctuation">|</span>lower == 'redhat'
<span class="token punctuation">-</span> <span class="token key atrule">import_tasks</span><span class="token punctuation">:</span> debian.yml
  <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_facts<span class="token punctuation">[</span><span class="token string">'os_family'</span><span class="token punctuation">]</span><span class="token punctuation">|</span>lower == 'debian'

<span class="token comment"># roles/webservers/tasks/redhat.yml</span>
<span class="token punctuation">-</span> <span class="token key atrule">yum</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;httpd&quot;</span>
    <span class="token key atrule">state</span><span class="token punctuation">:</span> present

<span class="token comment"># roles/webservers/tasks/debian.yml</span>
<span class="token punctuation">-</span> <span class="token key atrule">apt</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;apache2&quot;</span>
    <span class="token key atrule">state</span><span class="token punctuation">:</span> present
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="使用角色"><a href="#使用角色" class="header-anchor">#</a> 使用角色</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># site.yml</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> webservers
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> common
    <span class="token punctuation">-</span> webservers


定义多个：
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">gather_facts</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all 
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> common

<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">gather_facts</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all 
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> webservers
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="角色控制"><a href="#角色控制" class="header-anchor">#</a> 角色控制</h3> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> 0.系统初始化
  <span class="token key atrule">gather_facts</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all 
  <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> common
  <span class="token key atrule">tags</span><span class="token punctuation">:</span> common 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="定义变量-2"><a href="#定义变量-2" class="header-anchor">#</a> 定义变量</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>组变量：
group_vars 存放的是组变量
group_vars/all.yml  表示所有主机有效，等同于<span class="token punctuation">[</span>all:vars<span class="token punctuation">]</span>
grous_vars/etcd.yml 表示etcd组主机有效，等同于<span class="token punctuation">[</span>etcd:vars<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-9354336437522810"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cf1998/kubernetes/edit/master/docs/_posts/Linux/Ansible 运维自动化.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Ansbile" title="标签">#Ansbile</a></div> <!----></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/k8s002/"><div>平滑升级Kubernetes集群(二进制)</div></a> <span>11-28</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/k8s001/"><div>Kubernetes 零宕机滚动更新</div></a> <span>11-27</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/uvrvk3/"><div>企业级高可用Kubernetes1.20.x集群(二进制)</div></a> <span>11-26</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:995345781@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/cf1998" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2021
    <span>CloudNative Operations</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-9354336437522810"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.519980b4.js" defer></script><script src="/assets/js/2.f3cfc96e.js" defer></script><script src="/assets/js/19.fce8cb8d.js" defer></script>
  </body>
</html>