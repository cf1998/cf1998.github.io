import { _ as _export_sfc, o as openBlock, c as createElementBlock, a as createStaticVNode } from "./app-18c0c063.js";
const _sfc_main = {};
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h2 id="上篇回顾" tabindex="-1"><a class="header-anchor" href="#上篇回顾" aria-hidden="true">#</a> 上篇回顾</h2><p>上篇内容我们主要针对自动发现以及标签进行了讲解，但是我们还缺少很重要的一个环节告警，本篇内容就讲解Prometheus告警以及一些常用的告警媒介</p><h2 id="自定义告警规则" tabindex="-1"><a class="header-anchor" href="#自定义告警规则" aria-hidden="true">#</a> 自定义告警规则</h2><p>由<code>prometheus-prometheusRule.yaml</code>可以看出告警规则都是在该yaml中定义的</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># cat    prometheus-prometheusRule.yaml  </span>\n\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> PrometheusRule\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> prometheus\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> prometheus\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus\n    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 2.26.0\n    <span class="token key atrule">prometheus</span><span class="token punctuation">:</span> k8s\n    <span class="token key atrule">role</span><span class="token punctuation">:</span> alert<span class="token punctuation">-</span>rules\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus<span class="token punctuation">-</span>k8s<span class="token punctuation">-</span>prometheus<span class="token punctuation">-</span>rules\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">groups</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus\n    <span class="token key atrule">rules</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> PrometheusBadConfig\n      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>\n        <span class="token key atrule">description</span><span class="token punctuation">:</span> Prometheus <span class="token punctuation">{</span><span class="token punctuation">{</span>$labels.namespace<span class="token punctuation">}</span><span class="token punctuation">}</span>/<span class="token punctuation">{</span><span class="token punctuation">{</span>$labels.pod<span class="token punctuation">}</span><span class="token punctuation">}</span> has failed to reload its configuration.\n        <span class="token key atrule">runbook_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/prometheus<span class="token punctuation">-</span>operator/kube<span class="token punctuation">-</span>prometheus/wiki/prometheusbadconfig\n        <span class="token key atrule">summary</span><span class="token punctuation">:</span> Failed Prometheus configuration reload.\n      <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n        # Without max_over_time, failed scrapes could create false negatives, see\n        # https://www.robustperception.io/alerting-on-gauges-in-prometheus-2-0 for details.\n        max_over_time(prometheus_config_last_reload_successful{job=&quot;prometheus-k8s&quot;,namespace=&quot;monitoring&quot;}[5m]) == 0</span>\n      <span class="token key atrule">for</span><span class="token punctuation">:</span> 10m\n      <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n        <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>仅仅截取的部分内容，其中几个关键的地方metadata.labels为prometheus: k8s、role: alert-rules</p></blockquote><p>查看prometheus-prometheus.yaml中对应的rules:</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># cat   prometheus-prometheus.yaml  </span>\n\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Prometheus\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> prometheus\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> prometheus\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus\n    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 2.26.0\n    <span class="token key atrule">prometheus</span><span class="token punctuation">:</span> k8s\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> k8s\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">alerting</span><span class="token punctuation">:</span>\n    <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v2\n      <span class="token key atrule">name</span><span class="token punctuation">:</span> alertmanager<span class="token punctuation">-</span>main\n      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring\n      <span class="token key atrule">port</span><span class="token punctuation">:</span> web\n  <span class="token key atrule">externalLabels</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/prometheus/prometheus<span class="token punctuation">:</span>v2.26.0\n  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>\n    <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux\n  <span class="token key atrule">podMetadata</span><span class="token punctuation">:</span>\n    <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n      <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> prometheus\n      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> prometheus\n      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus\n      <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 2.26.0\n  <span class="token key atrule">podMonitorNamespaceSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token key atrule">podMonitorSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token key atrule">probeNamespaceSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token key atrule">probeSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>\n  <span class="token key atrule">resources</span><span class="token punctuation">:</span>\n    <span class="token key atrule">requests</span><span class="token punctuation">:</span>\n      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 400Mi\n  <span class="token key atrule">ruleSelector</span><span class="token punctuation">:</span>\n    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>\n      <span class="token key atrule">prometheus</span><span class="token punctuation">:</span> k8s\n      <span class="token key atrule">role</span><span class="token punctuation">:</span> alert<span class="token punctuation">-</span>rules\n  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>\n    <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> <span class="token number">2000</span>\n    <span class="token key atrule">runAsNonRoot</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n    <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1000</span>\n  <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> prometheus<span class="token punctuation">-</span>k8s\n  <span class="token key atrule">serviceMonitorNamespaceSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token key atrule">serviceMonitorSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token key atrule">version</span><span class="token punctuation">:</span> 2.26.0\n  <span class="token key atrule">additionalScrapeConfigs</span><span class="token punctuation">:</span>\n    <span class="token key atrule">name</span><span class="token punctuation">:</span> kubesre<span class="token punctuation">-</span>com<span class="token punctuation">-</span>secret\n    <span class="token key atrule">key</span><span class="token punctuation">:</span> kubesre<span class="token punctuation">-</span>com.yaml\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>其中spec.ruleSelector中由 prometheus: k8s、role: alert-rules，不难看出告警规则引用附带的标签，所以我们可以自定义一个告警文件</p></blockquote><h2 id="自定义告警文件" tabindex="-1"><a class="header-anchor" href="#自定义告警文件" aria-hidden="true">#</a> 自定义告警文件</h2><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># cat container-processesRule.yaml </span>\n\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> PrometheusRule\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">prometheus</span><span class="token punctuation">:</span> k8s\n    <span class="token key atrule">role</span><span class="token punctuation">:</span> alert<span class="token punctuation">-</span>rules\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubesre<span class="token punctuation">-</span>com\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">groups</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test\n      <span class="token key atrule">rules</span><span class="token punctuation">:</span>\n        <span class="token punctuation">-</span> <span class="token key atrule">alert</span><span class="token punctuation">:</span> kubesre\n          <span class="token key atrule">annotations</span><span class="token punctuation">:</span>\n            <span class="token key atrule">summary</span><span class="token punctuation">:</span> <span class="token string">&quot;container-process 大于 100&quot;</span>\n            <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&quot;当前实例: {{ $labels.instance }},告警值为:  {{ $value }}&quot;</span>\n          <span class="token key atrule">expr</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n            container_processes &gt; 100</span>\n          <span class="token key atrule">for</span><span class="token punctuation">:</span> 3m\n          <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n            <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning\n            \n            \n<span class="token comment"># kubectl apply -f container-processesRule.yaml</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更多告警规则可以参考：https://samber.github.io/awesome-prometheus-alerts/</p></blockquote><p>当然也可以直接在 prometheus-prometheusRule.yaml继续添加报警规则</p><h2 id="查看prometheus告警规则" tabindex="-1"><a class="header-anchor" href="#查看prometheus告警规则" aria-hidden="true">#</a> 查看prometheus告警规则</h2><p><img src="https://img.kubesre.com/kubesre/20230822/1.png" alt=""></p><p><img src="https://img.kubesre.com/kubesre/20230822/2.png" alt=""></p><h2 id="案例介绍" tabindex="-1"><a class="header-anchor" href="#案例介绍" aria-hidden="true">#</a> 案例介绍</h2><p>基于自定义告警，我们使用prometheusAlert进行告警媒介的对接，本次实验仅基于钉钉进行告警，更多告警渠道可以参考promethesAlert有详细说明。</p><h2 id="环境概览" tabindex="-1"><a class="header-anchor" href="#环境概览" aria-hidden="true">#</a> 环境概览</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectl get nodes </span>\nNAME               STATUS   ROLES                  AGE   VERSION\nk8s-master-50.57   Ready    control-plane,master   96d   v1.20.5\nk8s-node-50.58     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 96d   v1.20.5\nk8s-node-50.59     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 96d   v1.20.5\n\n<span class="token comment"># kubectl get pod -n monitoring </span>\nNAME                                  READY   STATUS    RESTARTS   AGE\nalertmanager-main-0                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nalertmanager-main-1                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nalertmanager-main-2                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nblackbox-exporter-55c457d5fb-5m7ql    <span class="token number">3</span>/3     Running   <span class="token number">0</span>          8d\ngrafana-9df57cdc4-gpzsq               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nkube-state-metrics-56dbb74497-gpkn9   <span class="token number">3</span>/3     Running   <span class="token number">0</span>          8d\nnode-exporter-4wl6d                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nnode-exporter-b4595                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nnode-exporter-g4l99                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nprometheus-adapter-59df95d9f5-tnt4w   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nprometheus-adapter-59df95d9f5-xhz5v   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nprometheus-k8s-0                      <span class="token number">2</span>/2     Running   <span class="token number">1</span>          8d\nprometheus-k8s-1                      <span class="token number">2</span>/2     Running   <span class="token number">1</span>          10m\nprometheus-operator-c46b8b7c9-mg9cv   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="prometheusalert部署" tabindex="-1"><a class="header-anchor" href="#prometheusalert部署" aria-hidden="true">#</a> PrometheusAlert部署</h2><p>创建configMap:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># cat config.yaml </span>\n---\napiVersion: v1\ndata:\n  app.conf: <span class="token operator">&gt;</span>-\n    <span class="token comment">#---------------------↓全局配置-----------------------</span>\n\n    appname <span class="token operator">=</span> PrometheusAlert\n\n    <span class="token comment">#登录用户名</span>\n\n    <span class="token assign-left variable">login_user</span><span class="token operator">=</span>prometheusalert\n\n    <span class="token comment">#登录密码</span>\n\n    <span class="token assign-left variable">login_password</span><span class="token operator">=</span>prometheusalert\n\n    <span class="token comment">#监听地址</span>\n\n    httpaddr <span class="token operator">=</span> <span class="token string">&quot;0.0.0.0&quot;</span>\n\n    <span class="token comment">#监听端口</span>\n\n    httpport <span class="token operator">=</span> <span class="token number">8080</span>\n\n    runmode <span class="token operator">=</span> dev\n\n    <span class="token comment">#设置代理 proxy = http://123.123.123.123:8080</span>\n\n    proxy <span class="token operator">=</span>\n\n    <span class="token comment">#开启JSON请求</span>\n\n    copyrequestbody <span class="token operator">=</span> <span class="token boolean">true</span>\n\n    <span class="token comment">#告警消息标题</span>\n\n    <span class="token assign-left variable">title</span><span class="token operator">=</span>PrometheusAlert\n\n    <span class="token comment">#链接到告警平台地址</span>\n\n    <span class="token assign-left variable">GraylogAlerturl</span><span class="token operator">=</span>http://graylog.org\n\n    <span class="token comment">#钉钉告警 告警logo图标地址</span>\n\n    <span class="token assign-left variable">logourl</span><span class="token operator">=</span>https://raw.githubusercontent.com/feiyu563/PrometheusAlert/master/doc/alert-center.png\n\n    <span class="token comment">#钉钉告警 恢复logo图标地址</span>\n\n    <span class="token assign-left variable">rlogourl</span><span class="token operator">=</span>https://raw.githubusercontent.com/feiyu563/PrometheusAlert/master/doc/alert-center.png\n\n    <span class="token comment">#短信告警级别(等于3就进行短信告警) 告警级别定义 0 信息,1 警告,2 一般严重,3 严重,4 灾难</span>\n\n    <span class="token assign-left variable">messagelevel</span><span class="token operator">=</span><span class="token number">3</span>\n\n    <span class="token comment">#电话告警级别(等于4就进行语音告警) 告警级别定义 0 信息,1 警告,2 一般严重,3 严重,4 灾难</span>\n\n    <span class="token assign-left variable">phonecalllevel</span><span class="token operator">=</span><span class="token number">4</span>\n\n    <span class="token comment">#默认拨打号码(页面测试短信和电话功能需要配置此项)</span>\n\n    <span class="token assign-left variable">defaultphone</span><span class="token operator">=</span>xxxxxxxx\n\n    <span class="token comment">#故障恢复是否启用电话通知0为关闭,1为开启</span>\n\n    <span class="token assign-left variable">phonecallresolved</span><span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#是否前台输出file or console</span>\n\n    <span class="token assign-left variable">logtype</span><span class="token operator">=</span>file\n\n    <span class="token comment">#日志文件路径</span>\n\n    <span class="token assign-left variable">logpath</span><span class="token operator">=</span>logs/prometheusalertcenter.log\n\n    <span class="token comment">#转换Prometheus,graylog告警消息的时区为CST时区(如默认已经是CST时区，请勿开启)</span>\n\n    <span class="token assign-left variable">prometheus_cst_time</span><span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#数据库驱动，支持sqlite3，mysql,postgres如使用mysql或postgres，请开启db_host,db_port,db_user,db_password,db_name的注释</span>\n\n    <span class="token assign-left variable">db_driver</span><span class="token operator">=</span>sqlite3\n\n    <span class="token comment">#db_host=127.0.0.1</span>\n\n    <span class="token comment">#db_port=3306</span>\n\n    <span class="token comment">#db_user=root</span>\n\n    <span class="token comment">#db_password=root</span>\n\n    <span class="token comment">#db_name=prometheusalert</span>\n\n    <span class="token comment">#是否开启告警记录 0为关闭,1为开启</span>\n\n    <span class="token assign-left variable">AlertRecord</span><span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#是否开启告警记录定时删除 0为关闭,1为开启</span>\n\n    <span class="token assign-left variable">RecordLive</span><span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#告警记录定时删除周期，单位天</span>\n\n    <span class="token assign-left variable">RecordLiveDay</span><span class="token operator">=</span><span class="token number">7</span>\n\n    <span class="token comment"># 是否将告警记录写入es7，0为关闭，1为开启</span>\n\n    <span class="token assign-left variable">alert_to_es</span><span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment"># es地址，是[]string</span>\n\n    <span class="token comment"># beego.Appconfig.Strings读取配置为[]string，使用&quot;;&quot;而不是&quot;,&quot;</span>\n\n    <span class="token assign-left variable">to_es_url</span><span class="token operator">=</span>http://localhost:9200\n\n    <span class="token comment"># to_es_url=http://es1:9200;http://es2:9200;http://es3:9200</span>\n\n    <span class="token comment"># es用户和密码</span>\n\n    <span class="token comment"># to_es_user=username</span>\n\n    <span class="token comment"># to_es_pwd=password</span>\n\n    <span class="token comment"># 长连接最大空闲数</span>\n\n    <span class="token assign-left variable">maxIdleConns</span><span class="token operator">=</span><span class="token number">100</span>\n\n\n    <span class="token comment">#---------------------↓webhook-----------------------</span>\n\n    <span class="token comment">#是否开启钉钉告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-dingding<span class="token operator">=</span><span class="token number">1</span>\n\n    <span class="token comment">#默认钉钉机器人地址</span>\n\n    <span class="token assign-left variable">ddurl</span><span class="token operator">=</span>https://oapi.dingtalk.com/robot/send?access_token<span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#是否开启 @所有人(0为关闭,1为开启)</span>\n\n    <span class="token assign-left variable">dd_isatall</span><span class="token operator">=</span><span class="token number">0</span>\n\n\n    <span class="token comment">#是否开启微信告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-weixin<span class="token operator">=</span><span class="token number">1</span>\n\n    <span class="token comment">#默认企业微信机器人地址</span>\n\n    <span class="token assign-left variable">wxurl</span><span class="token operator">=</span>https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key<span class="token operator">=</span>xxxxx\n\n\n    <span class="token comment">#是否开启飞书告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-feishu<span class="token operator">=</span><span class="token number">1</span>\n\n    <span class="token comment">#默认飞书机器人地址</span>\n\n    <span class="token assign-left variable">fsurl</span><span class="token operator">=</span>https://open.feishu.cn/open-apis/bot/hook/xxxxxxxxx\n\n    <span class="token comment"># webhook 发送 http 请求的 contentType, 如 application/json,</span>\n    application/x-www-form-urlencoded，不配置默认 application/json\n\n    <span class="token assign-left variable">wh_contenttype</span><span class="token operator">=</span>application/json\n\n\n    <span class="token comment">#---------------------↓腾讯云接口-----------------------</span>\n\n    <span class="token comment">#是否开启腾讯云短信告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-txdx<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#腾讯云短信接口key</span>\n\n    <span class="token assign-left variable">TXY_DX_appkey</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#腾讯云短信模版ID 腾讯云短信模版配置可参考 prometheus告警:{1}</span>\n\n    <span class="token assign-left variable">TXY_DX_tpl_id</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#腾讯云短信sdk app id</span>\n\n    <span class="token assign-left variable">TXY_DX_sdkappid</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#腾讯云短信签名 根据自己审核通过的签名来填写</span>\n\n    <span class="token assign-left variable">TXY_DX_sign</span><span class="token operator">=</span>腾讯云\n\n\n    <span class="token comment">#是否开启腾讯云电话告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-txdh<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#腾讯云电话接口key</span>\n\n    <span class="token assign-left variable">TXY_DH_phonecallappkey</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#腾讯云电话模版ID</span>\n\n    <span class="token assign-left variable">TXY_DH_phonecalltpl_id</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#腾讯云电话sdk app id</span>\n\n    <span class="token assign-left variable">TXY_DH_phonecallsdkappid</span><span class="token operator">=</span>xxxxx\n\n\n    <span class="token comment">#---------------------↓华为云接口-----------------------</span>\n\n    <span class="token comment">#是否开启华为云短信告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-hwdx<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#华为云短信接口key</span>\n\n    <span class="token assign-left variable">HWY_DX_APP_Key</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment">#华为云短信接口Secret</span>\n\n    <span class="token assign-left variable">HWY_DX_APP_Secret</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment">#华为云APP接入地址(端口接口地址)</span>\n\n    <span class="token assign-left variable">HWY_DX_APP_Url</span><span class="token operator">=</span>https://rtcsms.cn-north-1.myhuaweicloud.com:10743\n\n    <span class="token comment">#华为云短信模板ID</span>\n\n    <span class="token assign-left variable">HWY_DX_Templateid</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment">#华为云签名名称，必须是已审核通过的，与模板类型一致的签名名称,按照自己的实际签名填写</span>\n\n    <span class="token assign-left variable">HWY_DX_Signature</span><span class="token operator">=</span>华为云\n\n    <span class="token comment">#华为云签名通道号</span>\n\n    <span class="token assign-left variable">HWY_DX_Sender</span><span class="token operator">=</span>xxxxxxxxxx\n\n\n    <span class="token comment">#---------------------↓阿里云接口-----------------------</span>\n\n    <span class="token comment">#是否开启阿里云短信告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-alydx<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#阿里云短信主账号AccessKey的ID</span>\n\n    <span class="token assign-left variable">ALY_DX_AccessKeyId</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment">#阿里云短信接口密钥</span>\n\n    <span class="token assign-left variable">ALY_DX_AccessSecret</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment">#阿里云短信签名名称</span>\n\n    <span class="token assign-left variable">ALY_DX_SignName</span><span class="token operator">=</span>阿里云\n\n    <span class="token comment">#阿里云短信模板ID</span>\n\n    <span class="token assign-left variable">ALY_DX_Template</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n\n    <span class="token comment">#是否开启阿里云电话告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-alydh<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#阿里云电话主账号AccessKey的ID</span>\n\n    <span class="token assign-left variable">ALY_DH_AccessKeyId</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment">#阿里云电话接口密钥</span>\n\n    <span class="token assign-left variable">ALY_DH_AccessSecret</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment">#阿里云电话被叫显号，必须是已购买的号码</span>\n\n    <span class="token assign-left variable">ALY_DX_CalledShowNumber</span><span class="token operator">=</span>xxxxxxxxx\n\n    <span class="token comment">#阿里云电话文本转语音（TTS）模板ID</span>\n\n    <span class="token assign-left variable">ALY_DH_TtsCode</span><span class="token operator">=</span>xxxxxxxx\n\n\n    <span class="token comment">#---------------------↓容联云接口-----------------------</span>\n\n    <span class="token comment">#是否开启容联云电话告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-rlydh<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#容联云基础接口地址</span>\n\n    <span class="token assign-left variable">RLY_URL</span><span class="token operator">=</span>https://app.cloopen.com:8883/2013-12-26/Accounts/\n\n    <span class="token comment">#容联云后台SID</span>\n\n    <span class="token assign-left variable">RLY_ACCOUNT_SID</span><span class="token operator">=</span>xxxxxxxxxxx\n\n    <span class="token comment">#容联云api-token</span>\n\n    <span class="token assign-left variable">RLY_ACCOUNT_TOKEN</span><span class="token operator">=</span>xxxxxxxxxx\n\n    <span class="token comment">#容联云app_id</span>\n\n    <span class="token assign-left variable">RLY_APP_ID</span><span class="token operator">=</span>xxxxxxxxxxxxx\n\n\n    <span class="token comment">#---------------------↓邮件配置-----------------------</span>\n\n    <span class="token comment">#是否开启邮件</span>\n\n    open-email<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#邮件发件服务器地址</span>\n\n    <span class="token assign-left variable">Email_host</span><span class="token operator">=</span>smtp.qq.com\n\n    <span class="token comment">#邮件发件服务器端口</span>\n\n    <span class="token assign-left variable">Email_port</span><span class="token operator">=</span><span class="token number">465</span>\n\n    <span class="token comment">#邮件帐号</span>\n\n    <span class="token assign-left variable">Email_user</span><span class="token operator">=</span>xxxxxxx@qq.com\n\n    <span class="token comment">#邮件密码</span>\n\n    <span class="token assign-left variable">Email_password</span><span class="token operator">=</span>xxxxxx\n\n    <span class="token comment">#邮件标题</span>\n\n    <span class="token assign-left variable">Email_title</span><span class="token operator">=</span>运维告警\n\n    <span class="token comment">#默认发送邮箱</span>\n\n    <span class="token assign-left variable">Default_emails</span><span class="token operator">=</span>xxxxx@qq.com,xxxxx@qq.com\n\n\n    <span class="token comment">#---------------------↓七陌云接口-----------------------</span>\n\n    <span class="token comment">#是否开启七陌短信告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-7moordx<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#七陌账户ID</span>\n\n    <span class="token assign-left variable">7MOOR_ACCOUNT_ID</span><span class="token operator">=</span>Nxxx\n\n    <span class="token comment">#七陌账户APISecret</span>\n\n    <span class="token assign-left variable">7MOOR_ACCOUNT_APISECRET</span><span class="token operator">=</span>xxx\n\n    <span class="token comment">#七陌账户短信模板编号</span>\n\n    <span class="token assign-left variable">7MOOR_DX_TEMPLATENUM</span><span class="token operator">=</span>n\n\n    <span class="token comment">#注意：七陌短信变量这里只用一个var1，在代码里写死了。</span>\n\n    <span class="token comment">#-----------</span>\n\n    <span class="token comment">#是否开启七陌webcall语音通知告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-7moordh<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#请在七陌平台添加虚拟服务号、文本节点</span>\n\n    <span class="token comment">#七陌账户webcall的虚拟服务号</span>\n\n    <span class="token assign-left variable">7MOOR_WEBCALL_SERVICENO</span><span class="token operator">=</span>xxx\n\n    <span class="token comment"># 文本节点里被替换的变量，我配置的是text。如果被替换的变量不是text，请修改此配置</span>\n\n    <span class="token assign-left variable">7MOOR_WEBCALL_VOICE_VAR</span><span class="token operator">=</span>text\n\n\n    <span class="token comment">#---------------------↓telegram接口-----------------------</span>\n\n    <span class="token comment">#是否开启telegram告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-tg<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#tg机器人token</span>\n\n    <span class="token assign-left variable">TG_TOKEN</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#tg消息模式 个人消息或者频道消息 0为关闭(推送给个人)，1为开启(推送给频道)</span>\n\n    <span class="token assign-left variable">TG_MODE_CHAN</span><span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#tg用户ID</span>\n\n    <span class="token assign-left variable">TG_USERID</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#tg频道name或者id, 频道name需要以@开始</span>\n\n    <span class="token assign-left variable">TG_CHANNAME</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#tg api地址, 可以配置为代理地址</span>\n\n    <span class="token comment">#TG_API_PROXY=&quot;https://api.telegram.org/bot%s/%s&quot;</span>\n\n\n    <span class="token comment">#---------------------↓workwechat接口-----------------------</span>\n\n    <span class="token comment">#是否开启workwechat告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-workwechat<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment"># 企业ID</span>\n\n    <span class="token assign-left variable">WorkWechat_CropID</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment"># 应用ID</span>\n\n    <span class="token assign-left variable">WorkWechat_AgentID</span><span class="token operator">=</span>xxxx\n\n    <span class="token comment"># 应用secret</span>\n\n    <span class="token assign-left variable">WorkWechat_AgentSecret</span><span class="token operator">=</span>xxxx\n\n    <span class="token comment"># 接受用户</span>\n\n    <span class="token assign-left variable">WorkWechat_ToUser</span><span class="token operator">=</span><span class="token string">&quot;zhangsan|lisi&quot;</span>\n\n    <span class="token comment"># 接受部门</span>\n\n    <span class="token assign-left variable">WorkWechat_ToParty</span><span class="token operator">=</span><span class="token string">&quot;ops|dev&quot;</span>\n\n    <span class="token comment"># 接受标签</span>\n\n    <span class="token assign-left variable">WorkWechat_ToTag</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>\n\n    <span class="token comment"># 消息类型, 暂时只支持markdown</span>\n\n    <span class="token comment"># WorkWechat_Msgtype = &quot;markdown&quot;</span>\n\n\n    <span class="token comment">#---------------------↓百度云接口-----------------------</span>\n\n    <span class="token comment">#是否开启百度云短信告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-baidudx<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#百度云短信接口AK(ACCESS_KEY_ID)</span>\n\n    <span class="token assign-left variable">BDY_DX_AK</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#百度云短信接口SK(SECRET_ACCESS_KEY)</span>\n\n    <span class="token assign-left variable">BDY_DX_SK</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#百度云短信ENDPOINT（ENDPOINT参数需要用指定区域的域名来进行定义，如服务所在区域为北京，则为）</span>\n\n    <span class="token assign-left variable">BDY_DX_ENDPOINT</span><span class="token operator">=</span>http://smsv3.bj.baidubce.com\n\n    <span class="token comment">#百度云短信模版ID,根据自己审核通过的模版来填写(模版支持一个参数code：如prometheus告警:{code})</span>\n\n    <span class="token assign-left variable">BDY_DX_TEMPLATE_ID</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment">#百度云短信签名ID，根据自己审核通过的签名来填写</span>\n\n    <span class="token assign-left variable">TXY_DX_SIGNATURE_ID</span><span class="token operator">=</span>xxxxx\n\n\n    <span class="token comment">#---------------------↓百度Hi(如流)-----------------------</span>\n\n    <span class="token comment">#是否开启百度Hi(如流)告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-ruliu<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#默认百度Hi(如流)机器人地址</span>\n\n    <span class="token assign-left variable">BDRL_URL</span><span class="token operator">=</span>https://api.im.baidu.com/api/msg/groupmsgsend?access_token<span class="token operator">=</span>xxxxxxxxxxxxxx\n\n    <span class="token comment">#百度Hi(如流)群ID</span>\n\n    <span class="token assign-left variable">BDRL_ID</span><span class="token operator">=</span><span class="token number">123456</span>\n\n    <span class="token comment">#---------------------↓bark接口-----------------------</span>\n\n    <span class="token comment">#是否开启telegram告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-bark<span class="token operator">=</span><span class="token number">0</span>\n\n    <span class="token comment">#bark默认地址, 建议自行部署bark-server</span>\n\n    <span class="token assign-left variable">BARK_URL</span><span class="token operator">=</span>https://api.day.app\n\n    <span class="token comment">#bark key, 多个key使用分割</span>\n\n    <span class="token assign-left variable">BARK_KEYS</span><span class="token operator">=</span>xxxxx\n\n    <span class="token comment"># 复制, 推荐开启</span>\n\n    <span class="token assign-left variable">BARK_COPY</span><span class="token operator">=</span><span class="token number">1</span>\n\n    <span class="token comment"># 历史记录保存,推荐开启</span>\n\n    <span class="token assign-left variable">BARK_ARCHIVE</span><span class="token operator">=</span><span class="token number">1</span>\n\n    <span class="token comment"># 消息分组</span>\n\n    <span class="token assign-left variable">BARK_GROUP</span><span class="token operator">=</span>PrometheusAlert\n\n\n    <span class="token comment">#---------------------↓语音播报-----------------------</span>\n\n    <span class="token comment">#语音播报需要配合语音播报插件才能使用</span>\n\n    <span class="token comment">#是否开启语音播报通道,0为关闭,1为开启</span>\n\n    open-voice<span class="token operator">=</span><span class="token number">1</span>\n\n    <span class="token assign-left variable">VOICE_IP</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1\n\n    <span class="token assign-left variable">VOICE_PORT</span><span class="token operator">=</span><span class="token number">9999</span>\n\n\n    <span class="token comment">#---------------------↓飞书机器人应用-----------------------</span>\n\n    <span class="token comment">#是否开启feishuapp告警通道,可同时开始多个通道0为关闭,1为开启</span>\n\n    open-feishuapp<span class="token operator">=</span><span class="token number">1</span>\n\n    <span class="token comment"># APPID</span>\n\n    <span class="token assign-left variable">FEISHU_APPID</span><span class="token operator">=</span>cli_xxxxxxxxxxxxx\n\n    <span class="token comment"># APPSECRET</span>\n\n    <span class="token assign-left variable">FEISHU_APPSECRET</span><span class="token operator">=</span>xxxxxxxxxxxxxxxxxxxxxx\n\n    <span class="token comment"># 可填飞书 用户open_id、user_id、union_ids、部门open_department_id</span>\n\n    <span class="token assign-left variable">AT_USER_ID</span><span class="token operator">=</span><span class="token string">&quot;xxxxxxxx&quot;</span>\nkind: ConfigMap\nmetadata:\n  name: prometheusalert\n  namespace: monitoring\n  \n<span class="token comment">#  kubectl   apply   -f   config.yaml</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建deployment以及service:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># cat deployment.yaml  </span>\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: prometheusalert\n  namespace: monitoring\n  labels:\n    k8s-app: prometheusalert\nspec:\n  replicas: <span class="token number">1</span>\n  selector:\n    matchLabels:\n      k8s-app: prometheusalert\n  strategy:\n    rollingUpdate:\n      maxSurge: <span class="token number">70</span>%\n      maxUnavailable: <span class="token number">25</span>%\n    type: RollingUpdate\n  template:\n    metadata:\n      labels:\n        k8s-app: prometheusalert\n    spec:\n      terminationGracePeriodSeconds: <span class="token number">60</span>\n      containers:\n      - name: prometheusalert\n        image: feiyu563/prometheus-alert:v4.9\n        imagePullPolicy: IfNotPresent\n        readinessProbe:\n          httpGet:\n            port: <span class="token number">8080</span>\n            path: /health\n          initialDelaySeconds: <span class="token number">30</span>\n          periodSeconds: <span class="token number">10</span>\n          timeoutSeconds: <span class="token number">30</span>\n          failureThreshold: <span class="token number">10</span>\n        livenessProbe:\n          httpGet:\n            port: <span class="token number">8080</span>\n            path: /health\n          initialDelaySeconds: <span class="token number">30</span>\n          periodSeconds: <span class="token number">10</span>\n          timeoutSeconds: <span class="token number">3</span>\n          failureThreshold: <span class="token number">1</span>\n        resources:\n          limits:\n            cpu: 500m\n            memory: 1Gi\n          requests:\n            cpu: 100m\n            memory: 512Mi\n        volumeMounts:\n        - name: prometheusalert-cm\n          mountPath: /app/conf/app.conf\n          subPath: app.conf\n      volumes:\n      - name: prometheusalert-cm\n        configMap:\n          name: prometheusalert\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  name: prometheusalert\n  namespace: monitoring\n  labels:\n    k8s-app: prometheusalert\nspec:\n  selector:\n    k8s-app: prometheusalert\n  ports:\n  - name: prometheusalert\n    port: <span class="token number">8080</span>\n    protocol: TCP\n  type: NodePort\n\n<span class="token comment">#  kubectl   apply   -f   deployment.yaml</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="访问-prometheusalert" tabindex="-1"><a class="header-anchor" href="#访问-prometheusalert" aria-hidden="true">#</a> 访问 PrometheusAlert</h2><p><img src="https://img.kubesre.com/kubesre/20230822/3.png" alt=""></p><p><img src="https://img.kubesre.com/kubesre/20230822/4.png" alt=""></p><h2 id="创建钉钉机器人" tabindex="-1"><a class="header-anchor" href="#创建钉钉机器人" aria-hidden="true">#</a> 创建钉钉机器人</h2><p><img src="https://img.kubesre.com/kubesre/20230822/5.png" alt=""></p><p><img src="https://img.kubesre.com/kubesre/20230822/6.png" alt=""></p><h2 id="prometheusalert-生成告警模板" tabindex="-1"><a class="header-anchor" href="#prometheusalert-生成告警模板" aria-hidden="true">#</a> PrometheusAlert 生成告警模板</h2><p><img src="https://img.kubesre.com/kubesre/20230822/7.png" alt=""></p><p><img src="https://img.kubesre.com/kubesre/20230822/8.png" alt=""></p><blockquote><p>模板测试内容，可以加群获取</p></blockquote><h2 id="自定义告警渠道" tabindex="-1"><a class="header-anchor" href="#自定义告警渠道" aria-hidden="true">#</a> 自定义告警渠道</h2><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># vim ding-alert.yaml </span>\n\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> monitoring.coreos.com/v1alpha1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> AlertmanagerConfig\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> ding<span class="token punctuation">-</span>alert\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">alertmanagerConfig</span><span class="token punctuation">:</span> ding<span class="token punctuation">-</span>alert\n<span class="token key atrule">spec</span><span class="token punctuation">:</span>\n  <span class="token key atrule">route</span><span class="token punctuation">:</span>\n    <span class="token key atrule">groupBy</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;instance&#39;</span><span class="token punctuation">]</span>\n    <span class="token key atrule">groupWait</span><span class="token punctuation">:</span> 30s\n    <span class="token key atrule">groupInterval</span><span class="token punctuation">:</span> 5m\n    <span class="token key atrule">repeatInterval</span><span class="token punctuation">:</span> 12h\n    <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">&#39;webhook&#39;</span>\n  <span class="token key atrule">receivers</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;webhook&#39;</span>\n    <span class="token key atrule">webhookConfigs</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">&#39;http://prometheusalert.monitoring.svc:8080/prometheusalert?type=dd&amp;tpl=prometheus-dd&amp;ddurl=https://oapi.dingtalk.com/robot/send?access_token=1dc4ecc33cadec98d93408a8c85bc95f2909c76500f2cb6e97e5d9065d9517d8&amp;at=18438613802&#39;</span>\n    \n<span class="token comment"># kubectl apply -f ding-alert.yaml</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://img.kubesre.com/kubesre/20230822/9.png" alt=""></p><p>修改alertmanager-alertmanager.yaml</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>  <span class="token key atrule">configSecret</span><span class="token punctuation">:</span>\n  <span class="token key atrule">alertmanagerConfigSelector</span><span class="token punctuation">:</span> <span class="token comment"># 匹配 AlertmanagerConfig 的标签</span>\n    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>\n      <span class="token key atrule">alertmanagerConfig</span><span class="token punctuation">:</span> ding<span class="token punctuation">-</span>alert\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>在该文件末尾出添加上述内容，别忘记了更新一下</p></blockquote><p><img src="https://img.kubesre.com/kubesre/20230822/10.png" alt=""></p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>本篇文章主要讲解了告警媒介以及自定义告警规则，在这里十分感谢PrometheusAlert作者。下期内容：告警路由</p>', 44);
const _hoisted_45 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache) {
  return openBlock(), createElementBlock("div", null, _hoisted_45);
}
const zidingyigaojing_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "zidingyigaojing.html.vue"]]);
export {
  zidingyigaojing_html as default
};
