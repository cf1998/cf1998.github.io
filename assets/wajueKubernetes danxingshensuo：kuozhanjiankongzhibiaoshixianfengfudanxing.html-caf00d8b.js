import { _ as _export_sfc, o as openBlock, c as createElementBlock, a as createStaticVNode } from "./app-1d3ef370.js";
const _sfc_main = {};
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h2 id="简介与总结" tabindex="-1"><a class="header-anchor" href="#简介与总结" aria-hidden="true">#</a> 简介与总结</h2><p>上一篇关于HPA的文章，我们了解到HPA的实现原理，通过对服务CPU的metrics的监控实现了Deployment的弹性伸缩，但是对于我们来说，HPA核心指标较为简单，不适合个性化业务弹性的需求。我们这边文章就来研究一下扩展自定义指标，丰富业务弹性能力。在开始之前，我们需要了解两个组件。分别是Metrics server和Prometheus adapter。</p><h2 id="metrics-server是什么" tabindex="-1"><a class="header-anchor" href="#metrics-server是什么" aria-hidden="true">#</a> Metrics server是什么？</h2><p>Metrics server是一个开源指标 API (metrics.k8s.io)实现，由 Kubernetes SIG 创建和维护。metrics-server 的主要目的是帮助 Kubernetes Horizontal Pod Autoscaler根据外部因素（例如大量 HTTP 流量）自动扩展或缩减应用程序工作负载。Metrics server提供了K8S集群的Core metrics(核心指标)：从 Kubelet、cAdvisor 等获取度量数据，再由metrics-server提供给 kube-scheduler、HPA、 控制器等使用。上一篇文章中的CPU，内存指标就是通过Metrics server获取到的。 下图显示了 HPA（Horizontal Pod Autoscaling）如何与指标服务器结合使用： <img src="https://img.kubesre.com/kubesre/1.jpeg" alt="1691316336382.jpg"> 概述: 将Metrics Server部署到您的K8S集群。 Metrics服务器从每个工作节点抓取kubelet指标，收集CPU和内存使用数据 对于每个应用程序工作负载。 Metrics服务器通过Kubernetes API服务器公开CPU和内存使用指标。横向Pod自动缩放器通过Kubernetes api服务器获取CPU和内存使用指标。然后。根据指标观察和目标阈值，决定何时扩大或缩小应用程序部署pod。</p><h2 id="prometheus-adapter是什么" tabindex="-1"><a class="header-anchor" href="#prometheus-adapter是什么" aria-hidden="true">#</a> Prometheus adapter是什么？</h2><p>Prometheus adapter与Metrics server类似，主要是通过扩展一个新的外部指标 API，HPA 控制器将使用该 API(external.metrics.k8s.io) 来获取这些指标。基于现有的自定义指标 API。除非明确指定，否则自定义指标 API 设计中与语义、实现和设计决策相关的所有部分也适用于外部指标 API。通常期望自定义指标适配器将提供自定义指标 API 和外部指标 API，但这不是一定的，这两个 API 可以单独实现和使用。</p><p>了解了自定义指标接入的原理后，假设你们的业务需要根据应用的QPS对服务进行弹性伸缩，让我们来试试吧~</p><h2 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践" aria-hidden="true">#</a> 最佳实践</h2><p>Prometheus adapter是kube-prometheus项目下的一个插件，小伙伴可以在你的K8S集群部署kube-prometheus，我的集群已部署，详细部署步骤不在本文中赘述，可以通过查看相关yaml文件了解部署内容：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#mkdir kube-prometheus </span>\n<span class="token comment">#cd kube-prometheus </span>\n<span class="token comment">#git clone https://github.com/coreos/kube-prometheus</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看Prometheus adapter yaml文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#cd kube-prometheus/manifests/</span>\n<span class="token comment">#mkdir prometheus-adapter</span>\n<span class="token comment">#mv prometheusAdapter*.yaml prometheus-adapter</span>\n<span class="token comment">#cd prometheus-adapter/</span>\n<span class="token comment">#ll</span>\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">483</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-apiService.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">577</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-clusterRoleAggregatedMetricsReader.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">495</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-clusterRoleBindingDelegator.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">472</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-clusterRoleBinding.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">379</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-clusterRoleServerResources.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">410</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-clusterRole.yaml\n-rw-r--r-- <span class="token number">1</span> root root <span class="token number">2205</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-configMap.yaml\n-rw-r--r-- <span class="token number">1</span> root root <span class="token number">3286</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-deployment.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">565</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-networkPolicy.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">502</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-podDisruptionBudget.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">516</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-roleBindingAuthReader.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">324</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-serviceAccount.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">907</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-serviceMonitor.yaml\n-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">502</span> Aug  <span class="token number">6</span> <span class="token number">18</span>:23 prometheusAdapter-service.yaml\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装kube-prometheus后验证" tabindex="-1"><a class="header-anchor" href="#安装kube-prometheus后验证" aria-hidden="true">#</a> 安装kube-prometheus后验证</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectl api-versions| grep metrics</span>\nexternal.metrics.k8s.io/v1beta1  <span class="token comment">#接入自定义指标的api</span>\nmetrics.k8s.io/v1beta1\n<span class="token comment"># kubectl get pods -n monitoring -o wide | grep prometheus-adapter</span>\nprometheus-adapter-667b85b9ff-dx858   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          86d   <span class="token number">172.28</span>.7.26   cn-shanghai.10.0.54.97   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>\n<span class="token comment"># kubectl get --raw &quot;/apis/external.metrics.k8s.io&quot; | jq .</span>\n<span class="token punctuation">{</span>\n  <span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;APIGroup&quot;</span>,\n  <span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v1&quot;</span>,\n  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;external.metrics.k8s.io&quot;</span>,\n  <span class="token string">&quot;versions&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      <span class="token string">&quot;groupVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;external.metrics.k8s.io/v1beta1&quot;</span>,\n      <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v1beta1&quot;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span>,\n  <span class="token string">&quot;preferredVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>\n    <span class="token string">&quot;groupVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;external.metrics.k8s.io/v1beta1&quot;</span>,\n    <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v1beta1&quot;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果正常输出则说明安装正常 修改prometheus-adapter 的configmap，调整成需要监控的指标QPS，实际是对PromQL请求到数据做一次转换</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectl get cm -n monitoring prometheus-adapter -o yaml</span>\napiVersion: v1\ndata:\n  config.yaml: <span class="token operator">|</span>-\n    rules:\n    externalRules:\n    - metricsQuery: <span class="token operator">&lt;&lt;</span>.Series<span class="token operator">&gt;&gt;</span><span class="token punctuation">{</span><span class="token operator">&lt;&lt;</span>.LabelMatchers<span class="token operator">&gt;&gt;</span><span class="token punctuation">}</span>\n      name:\n        as: istio_request_qps\n        matches: service_request_qps\n      resources:\n        namespaced: <span class="token boolean">false</span>\n        overrides:\n          namespace:\n            resource: namespace\n      seriesQuery: service_request_qps\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>seriesQuery：即PromQL请求数据。</li><li>metricsQuery：对seriesQuery中PromQL请求的数据做聚合操作。</li><li>resources：是PromQL里的数据Label，与resource进行匹配，这里的resouce是指集群内的api-resource，比如Pod、Namespace和Node。可通过kubectl api-resources -o wide查看。此处Key对应Prometheus数据中的LabelName，请确认Prometheus指标数据中有此LabelName。</li><li>name：是指根据正则匹配把Prometheus指标名转为比较可读的指标名，这里是把http_request_total转为http_request_per_second。</li></ul><p>验证指标是否可以正常获取（namespace和metics名称需调整）</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl get <span class="token parameter variable">--raw</span> <span class="token string">&quot;/apis/external.metrics.k8s.io/v1beta1/namespaces/test/istio_request_qps&quot;</span> <span class="token operator">|</span> jq <span class="token builtin class-name">.</span>\n<span class="token punctuation">{</span>\n  <span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ExternalMetricValueList&quot;</span>,\n  <span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;external.metrics.k8s.io/v1beta1&quot;</span>,\n  <span class="token string">&quot;metadata&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,\n  <span class="token string">&quot;items&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      <span class="token string">&quot;metricName&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;istio_request_qps&quot;</span>,      <span class="token comment">#metric名称</span>\n      <span class="token string">&quot;metricLabels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>\n        <span class="token string">&quot;__name__&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;service_request_qps&quot;</span>,    \n        <span class="token string">&quot;app&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test-deploymet&quot;</span>,              <span class="token comment">#metric标签</span>\n        <span class="token string">&quot;instance&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.28.4.19:80&quot;</span>,\n        <span class="token string">&quot;job&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;istio-exporter&quot;</span>,\n        <span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test&quot;</span>,\n        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;istio&quot;</span>\n      <span class="token punctuation">}</span>,\n      <span class="token string">&quot;timestamp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2023-08-06T10:44:39Z&quot;</span>,\n      <span class="token string">&quot;value&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;30m&quot;</span>\n    <span class="token punctuation">}</span>,\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果正常获取，就看到胜利的曙光了。接下来配置HPA：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectl get hpa -n fp -o yaml</span>\napiVersion: v1\nitems:\n- apiVersion: autoscaling/v2\n  kind: HorizontalPodAutoscaler\n  metadata:\n    name: test-hpa\n    namespace: <span class="token builtin class-name">test</span>\n  spec:\n    maxReplicas: <span class="token number">3</span>    <span class="token comment">#最大副本数</span>\n    metrics:\n    - external:\n        metric:\n          name: istio_request_qps      <span class="token comment">#与上面的metric名称匹配</span>\n          selector:\n            matchLabels:\n              app: test-deployment     <span class="token comment">#与上面的metric标签匹配</span>\n        target:\n          averageValue: <span class="token string">&quot;30&quot;</span>    <span class="token comment">#metrics的阈值</span>\n          type: AverageValue    <span class="token comment">#metrics的阈值的类型</span>\n      type: External\n    minReplicas: <span class="token number">1</span>     <span class="token comment">#最小副本数</span>\n    scaleTargetRef:\n      apiVersion: apps/v1\n      kind: Deployment\n      name: test-deployment    <span class="token comment">#扩展的Deployment的名称</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用压测工具进行测试，观察HPA的状态变化</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># ab -c 100 -n 100000  172.28.4.19:80</span>\nThis is ApacheBench, Version <span class="token number">2.3</span> <span class="token operator">&lt;</span><span class="token variable">$Revision</span><span class="token builtin class-name">:</span> <span class="token number">1430300</span> $<span class="token operator">&gt;</span>\nCopyright <span class="token number">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking skywall-uat.snowballtech.com <span class="token punctuation">(</span>be patient<span class="token punctuation">)</span>\nCompleted <span class="token number">10000</span> requests\nCompleted <span class="token number">20000</span> requests\nCompleted <span class="token number">30000</span> requests\nCompleted <span class="token number">40000</span> requests\n\n<span class="token comment">## kubectl get hpa -n fp -w</span>\nNAME       REFERENCE                    TARGETS         MINPODS   MAXPODS   REPLICAS   AGE\ntest-hpa   Deployment/test-deployment   130m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          3m58s\ntest-hpa   Deployment/test-deployment   120m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          4m\ntest-hpa   Deployment/test-deployment   100m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          4m15s\ntest-hpa   Deployment/test-deployment   81980m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          4m30s\ntest-hpa   Deployment/test-deployment   78884m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          4m45s     <span class="token comment">#扩容到最大副本数</span>\ntest-hpa   Deployment/test-deployment   133027m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          5m1s\ntest-hpa   Deployment/test-deployment   190407m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          5m16s\ntest-hpa   Deployment/test-deployment   308950m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          5m31s\ntest-hpa   Deployment/test-deployment   165094m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          5m46s\ntest-hpa   Deployment/test-deployment   113644m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>   <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          6m1s\ntest-hpa   Deployment/test-deployment   60874m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>    <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          6m16s\ntest-hpa   Deployment/test-deployment   9477m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>     <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          6m31s\ntest-hpa   Deployment/test-deployment   2094m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>     <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          6m46s\ntest-hpa   Deployment/test-deployment   144m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>      <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          7m1s\ntest-hpa   Deployment/test-deployment   50m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          7m16s\ntest-hpa   Deployment/test-deployment   57m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          7m31s\ntest-hpa   Deployment/test-deployment   40m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          7m46s\ntest-hpa   Deployment/test-deployment   27m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          8m1s\ntest-hpa   Deployment/test-deployment   24m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          8m16s\ntest-hpa   Deployment/test-deployment   27m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          8m31s\ntest-hpa   Deployment/test-deployment   34m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          8m46s\ntest-hpa   Deployment/test-deployment   17m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          9m1s\ntest-hpa   Deployment/test-deployment   7m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>        <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">3</span>          9m16s\ntest-hpa   Deployment/test-deployment   10m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          9m31s    <span class="token comment">#减少至最小副本数</span>\ntest-hpa   Deployment/test-deployment   7m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>        <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          9m46s\ntest-hpa   Deployment/test-deployment   10m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>       <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          10m\ntest-hpa   Deployment/test-deployment   7m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>        <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          10m\ntest-hpa   Deployment/test-deployment   7m/30 <span class="token punctuation">(</span>avg<span class="token punctuation">)</span>        <span class="token number">1</span>         <span class="token number">3</span>         <span class="token number">1</span>          10m\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此，测试就结束了，实现了自定义的指标接入测试并实现了伸缩</p><h2 id="结论" tabindex="-1"><a class="header-anchor" href="#结论" aria-hidden="true">#</a> 结论</h2><p>在本文中，我们通过自定义指标提高了 HPA 与业务的深切感知，通过配置 Prometheus Adapter，我们演示了如何创建自定义指标，并配置 HPA 以使用这些指标来实现更精确的自动缩放。 有没有给你一些启发呢？希望你能将这些技术应用到 Kubernetes 中，并体验基于自定义指标的高效、弹性自动缩放的优势！</p>', 26);
const _hoisted_27 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache) {
  return openBlock(), createElementBlock("div", null, _hoisted_27);
}
const wajueKubernetes_danxingshensuo_kuozhanjiankongzhibiaoshixianfengfudanxing_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "wajueKubernetes danxingshensuo：kuozhanjiankongzhibiaoshixianfengfudanxing.html.vue"]]);
export {
  wajueKubernetes_danxingshensuo_kuozhanjiankongzhibiaoshixianfengfudanxing_html as default
};
