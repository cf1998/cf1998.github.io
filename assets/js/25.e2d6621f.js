(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{456:function(s,t,a){"use strict";a.r(t);var n=a(16),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"副本介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#副本介绍"}},[s._v("#")]),s._v(" 副本介绍")]),s._v(" "),a("p",[s._v("副本的目的主要是保障数据的高可用性，即使一台Clickhouse节点宕机，那么也可以从其他服务器获取想用的数据。")]),s._v(" "),a("p",[s._v("https://clickhouse.tech/docs/en/engines/table-engines/mergetree-family/replication/\n")]),s._v(" "),a("p",[a("strong",[s._v("副本写入流程")]),s._v(" ：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://kubesre.com/img/o_211021072943_1634798230983.png",alt:""}})]),s._v(" "),a("ol",[a("li",[s._v("客户端写入数据到Clickhouse-1节点上")]),s._v(" "),a("li",[s._v("Clickhouse-1提交写入日志到zookeeper集群")]),s._v(" "),a("li",[s._v("Clickhouse-2和Clickhouse-3会收到写入日志")]),s._v(" "),a("li",[s._v("从目标副本下载新数据")])]),s._v(" "),a("h2",{attrs:{id:"clickhouse集群安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse集群安装"}},[s._v("#")]),s._v(" Clickhouse集群安装")]),s._v(" "),a("h3",{attrs:{id:"环境介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境介绍"}},[s._v("#")]),s._v(" 环境介绍")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[s._v("主机名")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("IP")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("OS")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("software")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("clickhouse-1")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.1.104")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("CentOS Linux release 7.7")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("clickhouse，zookeeper")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("clickhouse-2")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.1.105")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("CentOS Linux release 7.7")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("clickhouse，zookeeper")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("clickhouse-3")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.1.106")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("CentOS Linux release 7.7")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("clickhouse，zookeeper")])])])]),s._v(" "),a("h3",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/redhat-release  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看系统版本")]),s._v("\nCentOS Linux release "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.7")]),s._v(".1908 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\n$ systemctl stop firewalld.service\n$ systemctl disable firewalld.service \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置打开文件数限制")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在所有节点的 /etc/security/limits.conf 文件的末尾加入以下内容")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.conf\n* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* soft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n* hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在所有节点的 /etc/security/limits.d/20-nproc.conf 文件的末尾加入以下内容")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.d/20-nproc.conf\n* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* soft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n* hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y libtool\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y *unixODBC*\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭selinux：")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" /etc/selinux/config\n$ setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap：")]),s._v("\n$ swapoff -a  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据规划设置主机名：")]),s._v("\nhostnamectl set-hostname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("hostname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置hosts记录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts")]),s._v("\n192.168.1.104 clickhouse-1\n192.168.1.105 clickhouse-2\n192.168.1.106 clickhouse-3\nEOF")]),s._v("    \n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("h3",{attrs:{id:"zookeeper集群安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper集群安装"}},[s._v("#")]),s._v(" zookeeper集群安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署JDK1.8.0_262")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -P /usr/local/src https://github.com/AdoptOpenJDK/openjdk8-upstream-binaries/releases/download/jdk8u262-b10/OpenJDK8U-jdk_x64_linux_8u262b10.tar.gz  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载jdk安装包")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf OpenJDK8U-jdk_x64_linux_8u262b10.tar.gz   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压jdk安装包")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" openjdk-8u262-b10 /application/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加环境变量")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/profile  ")]),s._v("\nexport JAVA_HOME=/application/openjdk-8u262-b10\nexport JRE_HOME="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/jre\nexport CLASSPATH=.:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/lib:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JRE_HOME}")]),s._v("/lib\nexport PATH="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/bin:"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\nEOF")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n$ java -version   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如出现如下则安装成功")]),s._v("\nopenjdk version "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.8.0_262"')]),s._v("\nOpenJDK Runtime Environment "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(".0_262-b10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nOpenJDK "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.262")]),s._v("-b10, mixed mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### Zookeeper部署(所有节点执行)")]),s._v("\n \n \n​``"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("shell\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Zookeeper软件包下载并解压")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -P /usr/local/src https://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.6.1/apache-zookeeper-3.6.1-bin.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxf apache-zookeeper-3.6.1-bin.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" apache-zookeeper-3.6.1-bin /application/zookeeper\n \n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建启动用户并创建存储目录")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -s /bin/bash -U zookeeper\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /application/data/zookeeper-data/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -Rf zookeeper.zookeeper /application/data/zookeeper-data/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -Rf zookeeper.zookeeper /application/zookeeper\n \n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建ServerID标识")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /application/data/zookeeper-data/myid     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#clickhouse-1上执行")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /application/data/zookeeper-data/myid     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#clickhouse-2上执行")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /application/data/zookeeper-data/myid     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#clickhouse-3上执行")]),s._v("\n \n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改ZooKeeper配置")]),s._v("\n \n \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /application/zookeeper/conf/zoo.cfg")]),s._v("\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/application/data/zookeeper-data\ndataLogDir=/application/zookeeper/logs\nclientPort=2181\nmaxClientCnxns=60\nautopurge.snapRetainCount=3\nautopurge.purgeInterval=1\nserver.1=192.168.1.104:2888:3888\nserver.2=192.168.1.105:2888:3888\nserver.3=192.168.1.106:2888:3888\nEOF")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建zookeeper启动文件并启动")]),s._v("\n \n \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /usr/lib/systemd/system/zookeeper.service")]),s._v("\n[Unit]\nDescription=zookeeper.service\nAfter=network.target\n \n[Service]\nUser=zookeeper\nGroup=zookeeper\nType=forking\nExecStart=/application/zookeeper/bin/zkServer.sh start\nExecStop=/application/zookeeper/bin/zkServer.sh stop\nExecReload=/application/zookeeper/bin/zkServer.sh restart\n[Install]\nEOF")]),s._v("\n \n \n$ systemctl start zookeeper.service   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动zookeeper")]),s._v("\n$ systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" zookeeper.service  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加开机自启动")]),s._v("\n$ systemctl status zookeeper.service  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测服务状态")]),s._v("\n​"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("``\n到此ZK集群搭建完毕\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br")])]),a("h3",{attrs:{id:"clickhouse安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse安装"}},[s._v("#")]),s._v(" Clickhouse安装")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装Clickhouse")]),s._v("\n​``"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("shell\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" yum-utils\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" --import https://repo.clickhouse.tech/CLICKHOUSE-KEY.GPG\n$ yum-config-manager --add-repo https://repo.clickhouse.tech/rpm/clickhouse.repo\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" clickhouse-server clickhouse-client\n​"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("``\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"clickhouse集群配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse集群配置"}},[s._v("#")]),s._v(" Clickhouse集群配置")]),s._v(" "),a("p",[s._v("在所有节点的的/etc/clickhouse-server/config.d 目录下创建一个名为 metrika.xml 的配置文件,内容如下：")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token prolog"}},[s._v('<?xml version="1.0"?>')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("yandex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("zookeeper-servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("192.168.1.104"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2181"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("node")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("192.168.1.105"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2181"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("node")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("node")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("192.168.1.106"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2181"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("node")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("zookeeper-servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("yandex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("在所有节点的的/etc/clickhouse-server/config.xml 中修改配置")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v(" 726 "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("zookeeper")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("incl")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("zookeeper-servers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("optional")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n 727 "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("include_from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/etc/clickhouse-server/config.d/metrika.xml"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("include_from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n \n  162 "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("listen_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("0.0.0.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("listen_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("启动clickhouse集群在所有节点中执行：")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ /etc/init.d/clickhouse-server start   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动服务")]),s._v("\n$ /etc/init.d/clickhouse-server status  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看服务状态")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"clickhouse副本集群验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse副本集群验证"}},[s._v("#")]),s._v(" Clickhouse副本集群验证")]),s._v(" "),a("p",[s._v("在Clickhouse节点分别建表：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接数据库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clickhouse-1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# clickhouse-client -h clickhouse-1 -m")]),s._v("\nClickHouse client version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.7")]),s._v(".3.14 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("official build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nConnecting to clickhouse-1:9000 as user default.\nConnected to ClickHouse server version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.7")]),s._v(".3 revision "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54449")]),s._v(".\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# clickhouse-1 上执行")]),s._v("\ncreate table t_order_rep "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" UInt32,\n sku_id String,\n total_amount Decimal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16,2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n create_time Datetime\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" engine "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ReplicatedMergeTree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/clickhouse/table/01/t_order_rep'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rep_104'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n partition by toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n primary key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n order by "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id,sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# clickhouse-2 上执行")]),s._v("\ncreate table t_order_rep "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" UInt32,\n sku_id String,\n total_amount Decimal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16,2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n create_time Datetime\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" engine "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ReplicatedMergeTree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/clickhouse/table/01/t_order_rep'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rep_105'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n partition by toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n primary key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n order by "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id,sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# clickhouse-3 上执行")]),s._v("\ncreate table t_order_rep "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" UInt32,\n sku_id String,\n total_amount Decimal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16,2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n create_time Datetime\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" engine "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ReplicatedMergeTree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/clickhouse/table/01/t_order_rep'")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rep_106'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n partition by toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n primary key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n order by "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id,sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("p",[s._v("参数解释：")]),s._v(" "),a("p",[s._v("ReplicatedMergeTree 中，")]),s._v(" "),a("p",[a("strong",[s._v("第一个参数")]),s._v("是分片的 zk_path 一般按照：/clickhouse/table/{shard}/{table_name} 的格式写，如果只有一个分片就写 01 即可；")]),s._v(" "),a("p",[a("strong",[s._v("第二个参数")]),s._v("是副本名称，相同的分片副本名称不能相同。")]),s._v(" "),a("p",[s._v("在clickhouse-1上执行insert语句")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("insert into t_order_rep values\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_001'")]),s._v(",1000.00,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2021-10-21 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_002'")]),s._v(",2000.00,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2021-10-21 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_004'")]),s._v(",2500.00,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2021-10-21 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_002'")]),s._v(",2000.00,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2021-06-21 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_003'")]),s._v(",600.00,"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2021-06-22 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("在clickhouse-1和clickhouse-2查看数据是否已同步成功:")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("\nclickhouse-2 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from t_order_rep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nSELECT *\nFROM t_order_rep\n\nQuery id: 0da07432-d0ae-4c23-bc15-d2db6c5e9fcb\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(" │ sre_003 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-22 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sre_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-10-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sre_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-10-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103")]),s._v(" │ sre_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-10-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104")]),s._v(" │ sre_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.006")]),s._v(" sec. \n\nclickhouse-3 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from t_order_rep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nSELECT *\nFROM t_order_rep\n\nQuery id: d07db1ef-2408-4eb6-8e6e-7768daaace26\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sre_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-10-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sre_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-10-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103")]),s._v(" │ sre_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-10-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(" │ sre_003 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-22 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104")]),s._v(" │ sre_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-06-21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.005")]),s._v(" sec. \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[s._v("到此Clickhouse副本集群已部署完毕！")])])}),[],!1,null,null,null);t.default=e.exports}}]);