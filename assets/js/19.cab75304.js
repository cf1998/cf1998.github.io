(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{449:function(s,a,r){"use strict";r.r(a);var t=r(16),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("p",[s._v("MariaDB和MySQL在广泛的环境中使用，但是如果您需要记录用户访问权限以符合组织的审计法规，则以前必须使用其他数据库解决方案。为了满足此需求，MariaDB开发了MariaDB审计插件。尽管MariaDB审核插件具有一些仅适用于MariaDB的独特功能，但它也可以与MySQL一起使用。\n"),s._v("\n基本上，MariaDB Audit Plugin的目的是记录服务器的活动。对于每个客户端会话，它记录谁连接到服务器（即用户名和主机），执行了哪些查询，访问了哪些表以及更改了服务器变量。此信息存储在循环日志文件中，或者可以发送到本地syslogd。")]),s._v(" "),r("h2",{attrs:{id:"下载server-audit-so插件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#下载server-audit-so插件"}},[s._v("#")]),s._v(" 下载server_audit.so插件")]),s._v(" "),r("p",[s._v("请到网站上进行下载对应的插件")]),s._v(" "),r("p",[s._v("http://server_audit.so/")]),s._v(" "),r("h2",{attrs:{id:"安装server-audit插件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安装server-audit插件"}},[s._v("#")]),s._v(" 安装server_audit插件")]),s._v(" "),r("p",[s._v("登录MySQL，执行命令获取MySQL的plugin目录")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("MySQL "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  SHOW GLOBAL VARIABLES LIKE "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'plugin_dir'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------+-------------------------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------+-------------------------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" plugin_dir    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" /data/mysql/lib/plugin/ "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------+-------------------------+\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("p",[s._v("将"),r("a",{attrs:{href:"http://server_audit.so/",target:"_blank",rel:"noopener noreferrer"}},[s._v("server_audit.so"),r("OutboundLink")],1),s._v("上传到/data/mysql/lib/plugin/ 下")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("$ ll /data/mysql/lib/plugin/\ntotal "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("52944")]),s._v("\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("94513")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" adt_null.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("365033")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" authentication_ldap_sasl_client.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("40406")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" auth_socket.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("669352")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" connection_control.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16923116")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" group_replication.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("664899")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" innodb_engine.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("929276")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" keyring_file.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("292122")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" keyring_udf.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("989837")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" libmemcached.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7944728")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" libpluginmecab.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16780")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" locking_service.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("49474")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" mypluglib.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("38302")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" mysql_no_login.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("22906309")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" mysqlx.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("618167")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" rewriter.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("709470")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" semisync_master.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("152501")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" semisync_slave.so\n-rw-r--r--. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  root    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("207976")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":12 server_audit.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("204711")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" validate_password.so\n-rwxr-xr-x. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql   "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("353090")]),s._v(" Jun  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" version_token.so\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br")])]),r("p",[s._v("在命令下安装"),r("a",{attrs:{href:"http://server_audit.so/",target:"_blank",rel:"noopener noreferrer"}},[s._v("server_audit.so"),r("OutboundLink")],1)]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("MySQL "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  INSTALL PLUGIN server_audit SONAME "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'server_audit.so'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("查看变量开启设置情况，默认貌似都是关闭的")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("MySQL "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%audit%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("编辑my.cnf,添加配置并重启服务")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("$ "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("添加到配置文件末尾）\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server_audit_events='CONNECT,QUERY,TABLE,QUERY_DDL,QUERY_DML,QUERY_DCL'")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_audit_logging")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_audit_file_path")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/mysql/log/\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_audit_file_rotate_size")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000000")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_audit_file_rotations")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_audit_file_rotate_now")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n \n \n$ /etc/init.d/mysql restart  （重启服务\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br")])]),r("p",[s._v("登录MySQL后发现，在MySQL环境下执行的任何命令都被记录到/data/mysql/log/server_audit.log，如果日志文件达到指定的大小，会自动切割")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("MySQL "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%audit%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-------------------------------+-----------------------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------------+-----------------------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_events           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_excl_users       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_file_path        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" /data/mysql/log/      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_file_rotate_now  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ON                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_file_rotate_size "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000000")]),s._v("             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_file_rotations   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_incl_users       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_loc_info         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_logging          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ON                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_mode             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_output_type      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("                  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_query_log_limit  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("                  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_syslog_facility  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LOG_USER              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_syslog_ident     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql-server_auditing "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_syslog_info      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" server_audit_syslog_priority  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LOG_INFO              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-------------------------------+-----------------------+\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" rows "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n$ ll /data/mysql/log/server_audi*   "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("查看审计日志文件）\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("24420391")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":31 /data/mysql/log/server_audit.log\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000031")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" 09:11 /data/mysql/log/server_audit.log.001\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000449")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":51 /data/mysql/log/server_audit.log.002\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000141")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":53 /data/mysql/log/server_audit.log.003\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000412")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 02:03 /data/mysql/log/server_audit.log.004\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000559")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" 05:28 /data/mysql/log/server_audit.log.005\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000297")]),s._v(" Dec "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":50 /data/mysql/log/server_audit.log.006\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000674")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":53 /data/mysql/log/server_audit.log.007\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000101")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":50 /data/mysql/log/server_audit.log.008\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000201")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 03:53 /data/mysql/log/server_audit.log.009\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000247")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 06:56 /data/mysql/log/server_audit.log.010\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000369")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":58 /data/mysql/log/server_audit.log.011\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000367")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":27 /data/mysql/log/server_audit.log.012\n-rw-r-----. "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" mysql mysql "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("200000050")]),s._v(" Dec  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":59 /data/mysql/log/server_audit.log.013\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br"),r("span",{staticClass:"line-number"},[s._v("38")]),r("br")])]),r("h2",{attrs:{id:"参数说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[s._v("#")]),s._v(" 参数说明")]),s._v(" "),r("p",[s._v("详细请参考：https://mariadb.com/kb/en/mariadb/server_audit-system-variables/")]),s._v(" "),r("ul",[r("li",[s._v("server_audit_output_type：指定日志输出类型，可为SYSLOG或FILE")]),s._v(" "),r("li",[s._v("server_audit_logging：启动或关闭审计")]),s._v(" "),r("li",[s._v("server_audit_events：指定记录事件的类型，可以用逗号分隔的多个值(connect,query,table)，如果开启了查询缓存(query cache)，查询直接从查询缓存返回数据，将没有table记录")]),s._v(" "),r("li",[s._v("server_audit_file_path：如server_audit_output_type为FILE，使用该变量设置存储日志的文件，可以指定目录，默认存放在数据目录的server_audit.log文件中")]),s._v(" "),r("li",[s._v("server_audit_file_rotate_size：限制日志文件的大小")]),s._v(" "),r("li",[s._v("server_audit_file_rotations：指定日志文件的数量，如果为0日志将从不轮转")]),s._v(" "),r("li",[s._v("server_audit_file_rotate_now：强制日志文件轮转")]),s._v(" "),r("li",[s._v("server_audit_incl_users：指定哪些用户的活动将记录，connect将不受此变量影响，该变量比")]),s._v(" "),r("li",[s._v("server_audit_excl_users优先级高")]),s._v(" "),r("li",[s._v("server_audit_syslog_facility：默认为LOG_USER，指定facility")]),s._v(" "),r("li",[s._v("server_audit_syslog_ident：设置ident，作为每个syslog记录的一部分")]),s._v(" "),r("li",[s._v("server_audit_syslog_info：指定的info字符串将添加到syslog记录")]),s._v(" "),r("li",[s._v("server_audit_syslog_priority：定义记录日志的syslogd priority")]),s._v(" "),r("li",[s._v("server_audit_excl_users：该列表的用户行为将不记录，connect将不受该设置影响")]),s._v(" "),r("li",[s._v("server_audit_mode：标识版本，用于开发测试")])]),s._v(" "),r("h2",{attrs:{id:"卸载server-audit"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#卸载server-audit"}},[s._v("#")]),s._v(" 卸载server_audit")]),s._v(" "),r("div",{staticClass:"language-shell11 line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("MySQL [(none)]> UNINSTALL PLUGIN server_audit;\nMySQL [(none)]> show variables like '%audit%';\nEmpty set (0.00 sec)\n \n防止server_audit 插件被卸载，需要在配置文件中添加:\n[mysqld]\nserver_audit=FORCE_PLUS_PERMANENT\n重启MySQL生效\n \n值得注意的是，应该在server_audit插件被安装好，并且已经运行之后添加这些配置，否则过早在配置文件添加这个选项，会导致MySQL发生启动错误！\nMySQL [(none)]> UNINSTALL PLUGIN server_audit;\nERROR 1702 (HY000): Plugin 'server_audit' is force_plus_permanent and can not be unloaded\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);