import { _ as _export_sfc, o as openBlock, c as createElementBlock, a as createStaticVNode } from "./app-d515af8b.js";
const _sfc_main = {};
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h2 id="什么是mongodb" tabindex="-1"><a class="header-anchor" href="#什么是mongodb" aria-hidden="true">#</a> 什么是MongoDB</h2><p>MongoDB是一种非关系型数据库管理系统（NoSQL），它被设计用于存储和检索大量数据，特别适用于处理大数据和实时应用程序。MongoDB的名称源自&quot;humongous&quot;（巨大的）这个词，它强调了MongoDB的优势，即能够轻松处理大规模的数据。 以下是MongoDB的一些关键特点和概念：</p><ol><li>非关系型数据存储：与传统的关系型数据库不同，MongoDB不使用表格结构，而是采用文档存储模型。数据以文档的形式存储，通常使用JSON或类似的格式，这使得MongoDB更加灵活，可以存储各种不同结构的数据。</li><li>高度可扩展：MongoDB是一个分布式数据库系统，可以在多台服务器上运行。它支持水平扩展，可以通过添加更多的服务器来增加存储容量和处理能力，以应对大规模数据和高负载的需求。</li><li>强大的查询语言：MongoDB提供了丰富的查询和索引功能，使您可以轻松地检索数据、筛选数据和执行聚合操作。</li><li>高性能：MongoDB的设计目标之一是提供高性能的读写操作。它使用内存映射文件来加速数据访问，同时支持垂直分割和水平分割以提高性能。</li><li>复制和故障容忍性：MongoDB支持数据复制，可以在多个服务器之间复制数据，以提供冗余和故障容忍性。如果一个服务器出现故障，系统可以自动切换到备用服务器。</li><li>开源和活跃的社区：MongoDB是开源的，拥有庞大的社区支持和活跃的开发团队。这意味着它不仅免费，还有许多可用的工具和扩展，以满足各种不同的需求。</li></ol><p>MongoDB广泛用于各种应用程序，包括Web应用程序、大数据分析、物联网（IoT）应用程序、日志管理和许多其他领域，因为它的灵活性和可扩展性使其适用于各种不同类型的数据存储需求。</p><h2 id="实现背景" tabindex="-1"><a class="header-anchor" href="#实现背景" aria-hidden="true">#</a> 实现背景</h2><p>在实际企业环境中，MongoDB需要多节点部署组成一个集群，可用于确保高可用性、容量扩展、负载均衡和数据备份。此时需要对整个MongoDB集群进行监控，持续关注集群的健康状况。因此我们使用MongoDB Exporter将指标转换为Prometheus的数据类型。最后通过Prometheus进行收集Mongodb集群的监控指标，并采用Grafana可视化。</p><h2 id="创建storageclasses" tabindex="-1"><a class="header-anchor" href="#创建storageclasses" aria-hidden="true">#</a> 创建StorageClasses</h2><p>基于NFS创建StorageClasses,作为Mongodb集群持久化存储。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 创建StorageClasses</span>\n$ kubectl apply <span class="token parameter variable">-f</span> sc.yml\nstorageclass.storage.k8s.io/kubesre-nfs created\n\n<span class="token comment"># 查看StorageClasses</span>\n$ kubectl get storageclasses.storage.k8s.io\nNAME                 PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\nkubesre-nfs          example.com/external-nfs   Delete          Immediate              <span class="token boolean">false</span>                  63s\nstandard <span class="token punctuation">(</span>default<span class="token punctuation">)</span>   rancher.io/local-path      Delete          WaitForFirstConsumer   <span class="token boolean">false</span>                  13d\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="maongodb集群部署" tabindex="-1"><a class="header-anchor" href="#maongodb集群部署" aria-hidden="true">#</a> MaongoDB集群部署</h2><p>通过Helm方式进行部署MongoDB集群</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 添加Helm仓库</span>\n$ helm repo <span class="token function">add</span> bitnami https://charts.bitnami.com/bitnami\n<span class="token string">&quot;bitnami&quot;</span> has been added to your repositories\n\n<span class="token comment"># 搜索 MangoDB</span>\n$ helm repo update\nHang tight <span class="token keyword">while</span> we grab the latest from your chart repositories<span class="token punctuation">..</span>.\n<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">&quot;higress.io&quot;</span> chart repository\n<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">&quot;bitnami&quot;</span> chart repository\n<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">&quot;ingress-nginx&quot;</span> chart repository\nUpdate Complete. ⎈Happy Helming<span class="token operator">!</span>⎈\n\n$ helm search repo mongodb\nNAME                   	CHART VERSION	APP VERSION	DESCRIPTION\nbitnami/mongodb        	<span class="token number">13.18</span>.4      	<span class="token number">6.0</span>.10     	MongoDB<span class="token punctuation">(</span>R<span class="token punctuation">)</span> is a relational <span class="token function">open</span> <span class="token builtin class-name">source</span> NoSQL da<span class="token punctuation">..</span>.\nbitnami/mongodb-sharded	<span class="token number">6.6</span>.6        	<span class="token number">6.0</span>.10     	MongoDB<span class="token punctuation">(</span>R<span class="token punctuation">)</span> is an <span class="token function">open</span> <span class="token builtin class-name">source</span> NoSQL database tha<span class="token punctuation">..</span>.\n\n<span class="token comment"># 将MongoDB Chat下载到本地</span>\n$ <span class="token function">mkdir</span> mongodb <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> mongodb\n$ helm pull bitnami/mongodb\n$ <span class="token function">tar</span> zxf mongodb-13.18.4.tgz\n$ <span class="token function">cp</span> mongodb/values.yaml ./values-test.yaml\n\n<span class="token comment"># 修改values-test.yaml</span>\n$ <span class="token function">cat</span> values-test.yaml \n\n<span class="token comment">## 配置文件中定义 storageClass: &quot;&quot;，会使用集群配置的 openebs 提供的 storageClass，</span>\n<span class="token comment">## 使用此文档部署，需要自行解决 storageClass 问题 (ceph, nfs, 公有云提供的 nfs)</span>\n\nglobal:\n  <span class="token comment"># 定义 storageClass 使用的类型</span>\n  storageClass: <span class="token string">&quot;nfs-client&quot;</span>\n\n<span class="token comment"># 定义 mongodb 集群为副本集模式</span>\narchitecture: replicaset\n\n<span class="token comment"># 启动集群认证功能，设置超级管理员账户密码</span>\nauth:\n  enabled: <span class="token boolean">true</span>\n  rootUser: root\n  rootPassword: <span class="token string">&quot;root&quot;</span>\n\n<span class="token comment"># 设置集群数量，3个</span>\nreplicaCount: <span class="token number">3</span>\n\n<span class="token comment"># 启用持久化存储，使用 global.storageClass 自动创建 pvc </span>\npersistence:\n  enabled: <span class="token boolean">true</span>\n  size: 20Gi\n\n\n<span class="token comment"># 安装MongoDB集群</span>\nhelm <span class="token function">install</span> mongodb-cluster mongodb <span class="token parameter variable">-f</span> ./values-test.yaml\nNAME: mongodb-cluster\nLAST DEPLOYED: Tue Sep <span class="token number">19</span> <span class="token number">15</span>:54:36 <span class="token number">2023</span>\nNAMESPACE: default\nSTATUS: deployed\nREVISION: <span class="token number">1</span>\nTEST SUITE: None\nNOTES:\nCHART NAME: mongodb\nCHART VERSION: <span class="token number">13.18</span>.4\nAPP VERSION: <span class="token number">6.0</span>.10\n\n** Please be patient <span class="token keyword">while</span> the chart is being deployed **\n\nMongoDB<span class="token operator">&amp;</span>reg<span class="token punctuation">;</span> can be accessed on the following DNS name<span class="token punctuation">(</span>s<span class="token punctuation">)</span> and ports from within your cluster:\n\n    mongodb-cluster-0.mongodb-cluster-headless.default.svc.cluster.local:27017\n    mongodb-cluster-1.mongodb-cluster-headless.default.svc.cluster.local:27017\n    mongodb-cluster-2.mongodb-cluster-headless.default.svc.cluster.local:27017\n\nTo get the root password run:\n\n    <span class="token builtin class-name">export</span> <span class="token assign-left variable">MONGODB_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl get secret <span class="token parameter variable">--namespace</span> default mongodb-cluster <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&quot;{.data.mongodb-root-password}&quot;</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span><span class="token variable">)</span></span>\n\nTo connect to your database, create a MongoDB<span class="token operator">&amp;</span>reg<span class="token punctuation">;</span> client container:\n\n    kubectl run <span class="token parameter variable">--namespace</span> default mongodb-cluster-client <span class="token parameter variable">--rm</span> <span class="token parameter variable">--tty</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span><span class="token string">&#39;Never&#39;</span> <span class="token parameter variable">--env</span><span class="token operator">=</span><span class="token string">&quot;MONGODB_ROOT_PASSWORD=<span class="token variable">$MONGODB_ROOT_PASSWORD</span>&quot;</span> <span class="token parameter variable">--image</span> docker.io/bitnami/mongodb:6.0.10-debian-11-r0 <span class="token parameter variable">--command</span> -- <span class="token function">bash</span>\n\nThen, run the following command:\n    mongosh admin <span class="token parameter variable">--host</span> <span class="token string">&quot;mongodb-cluster-0.mongodb-cluster-headless.default.svc.cluster.local:27017,mongodb-cluster-1.mongodb-cluster-headless.default.svc.cluster.local:27017,mongodb-cluster-2.mongodb-cluster-headless.default.svc.cluster.local:27017&quot;</span> <span class="token parameter variable">--authenticationDatabase</span> admin <span class="token parameter variable">-u</span> <span class="token variable">$MONGODB_ROOT_USER</span> <span class="token parameter variable">-p</span> <span class="token variable">$MONGODB_ROOT_PASSWORD</span>\n\n<span class="token comment"># 查看运行状态</span>\n$ kubectl  get pods  <span class="token operator">|</span> <span class="token function">grep</span> mongo\nmongodb-cluster-0           <span class="token number">1</span>/1     Running   <span class="token number">0</span>               17m\nmongodb-cluster-1           <span class="token number">1</span>/1     Running   <span class="token number">0</span>               6m42s\nmongodb-cluster-2           <span class="token number">1</span>/1     Running   <span class="token number">0</span>               4m29s\nmongodb-cluster-arbiter-0   <span class="token number">1</span>/1     Running   <span class="token number">4</span> <span class="token punctuation">(</span>7m51s ago<span class="token punctuation">)</span>   20m\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongodb-exporter-部署" tabindex="-1"><a class="header-anchor" href="#mongodb-exporter-部署" aria-hidden="true">#</a> MongoDB Exporter 部署</h2><p>接下来部署Mongodb Exporter：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 部署Mongodb Exporter</span>\n$ <span class="token function">cat</span> exporter.yml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: mongo-expoter\nspec:\n  template:\n    metadata:\n      labels:\n        app: mongo-expoter\n    spec:\n      containers:\n        - args:\n            - <span class="token string">&#39;--web.listen-address=:9104&#39;</span>\n            - <span class="token string">&#39;--mongodb.uri&#39;</span>\n            - <span class="token operator">&gt;</span>-\n              mongodb://mongodb-cluster-0.mongodb-cluster-headless.default.svc.cluster.local:27017,mongodb-cluster-1.mongodb-cluster-headless.default.svc.cluster.local:27017,mongodb-cluster-2.mongodb-cluster-headless.default.svc.cluster.local:27017/admin?authSource<span class="token operator">=</span>admin\n          image: <span class="token string">&#39;percona/mongodb_exporter:0.39.0&#39;</span>\n          imagePullPolicy: Always\n          name: mongo-expoter\n          resources:\n            requests:\n              cpu: 250m\n              memory: 512Mi\n\n$ kubectl apply <span class="token parameter variable">-f</span> exporter.yml\n\n<span class="token comment"># 部署Mongodb Exporter Service</span>\n$ <span class="token function">cat</span> service.yml\napiVersion: v1\nkind: Service\nmetadata:\n  name: mongo-exporter\nspec:\n  internalTrafficPolicy: Cluster\n  ipFamilies:\n    - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n    - port: <span class="token number">9104</span>\n      protocol: TCP\n      targetPort: <span class="token number">9104</span>\n  selector:\n    app: mongo-exporter\n  type: ClusterIP\n\n$ kubectl apply <span class="token parameter variable">-f</span> service.yml\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到此Exporter部署完毕！</p><h2 id="prometheus安装" tabindex="-1"><a class="header-anchor" href="#prometheus安装" aria-hidden="true">#</a> Prometheus安装</h2><p>接下来需要创建一个Configmap 存储Prometheus 的配置映射：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">cat</span> prometheus-cm.yml\napiVersion: v1\ndata:\n  prometheus.yml: <span class="token operator">|</span>-\n    global:\n      scrape_interval: 15s \n      evaluation_interval: 15s \n    scrape_configs:\n      - job_name: <span class="token string">&quot;exporter&quot;</span>\n        static_configs:\n          - targets: <span class="token punctuation">[</span><span class="token string">&quot;mongo-exporter:9104&quot;</span><span class="token punctuation">]</span>\nkind: ConfigMap\n  name: prometheus\n\n$ kubectl apply <span class="token parameter variable">-f</span> prometheus-cm.yml\n\n<span class="token comment"># 部署Prometheus</span>\n$ <span class="token function">cat</span> prometheus.yml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: prometheus\nspec:\n  template:\n    metadata:\n      labels:\n        app: prometheus\n      name: prometheus-pod\n    spec:\n      containers:\n        - image: prom/prometheus\n          imagePullPolicy: IfNotPresent\n          name: prometheus\n          ports:\n            - containerPort: <span class="token number">9090</span>\n              name: metrics\n              protocol: TCP\n          resources: <span class="token punctuation">{</span><span class="token punctuation">}</span>\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n          volumeMounts:\n            - mountPath: /etc/prometheus\n              name: prometheus-config\n      dnsPolicy: ClusterFirst\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      securityContext: <span class="token punctuation">{</span><span class="token punctuation">}</span>\n      terminationGracePeriodSeconds: <span class="token number">15</span>\n      volumes:\n        - configMap:\n            defaultMode: <span class="token number">420</span>\n            items:\n              - key: prometheus.yml\n                path: prometheus.yml\n            name: prometheus\n          name: prometheus-config\n\n\n<span class="token comment"># 创建Prometheus Service</span>\n$ <span class="token function">cat</span> prometheus-service.yml\napiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: <span class="token string">&#39;2023-09-19T14:12:15Z&#39;</span>\n  managedFields:\n    - apiVersion: v1\n      fieldsType: FieldsV1\n      fieldsV1:\n        <span class="token string">&#39;f:spec&#39;</span><span class="token builtin class-name">:</span>\n          <span class="token string">&#39;f:internalTrafficPolicy&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n          <span class="token string">&#39;f:ipFamilyPolicy&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n          <span class="token string">&#39;f:ports&#39;</span><span class="token builtin class-name">:</span>\n            .: <span class="token punctuation">{</span><span class="token punctuation">}</span>\n            <span class="token string">&#39;k:{&quot;port&quot;:9090,&quot;protocol&quot;:&quot;TCP&quot;}&#39;</span><span class="token builtin class-name">:</span>\n              .: <span class="token punctuation">{</span><span class="token punctuation">}</span>\n              <span class="token string">&#39;f:port&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n              <span class="token string">&#39;f:protocol&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n              <span class="token string">&#39;f:targetPort&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n          <span class="token string">&#39;f:selector&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n          <span class="token string">&#39;f:sessionAffinity&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n          <span class="token string">&#39;f:type&#39;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n      manager: ACK-Console Apache-HttpClient\n      operation: Update\n      time: <span class="token string">&#39;2023-09-19T14:12:15Z&#39;</span>\n  name: prometheues\n  namespace: default\n  resourceVersion: <span class="token string">&#39;531698594&#39;</span>\n  uid: 0187137d-6805-4179-9981-dfa5481b8d5e\nspec:\n  clusterIP: <span class="token number">172.25</span>.7.25\n  clusterIPs:\n    - <span class="token number">172.25</span>.7.25\n  internalTrafficPolicy: Cluster\n  ipFamilies:\n    - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n    - port: <span class="token number">9090</span>\n      protocol: TCP\n      targetPort: <span class="token number">9090</span>\n  selector:\n    app: prometheus\n  sessionAffinity: None\n  type: ClusterIP\nstatus:\n  loadBalancer: <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n$ kubectl apply <span class="token parameter variable">-f</span> prometheus-service.yml\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时可以访问Prometheus控制台了： <img src="https://img.kubesre.com/kubesre/20230913/11.png" alt="image.png"></p><h2 id="grafana-部署" tabindex="-1"><a class="header-anchor" href="#grafana-部署" aria-hidden="true">#</a> Grafana 部署</h2><p>开始部署Grafana喽：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 部署Grafana</span>\n$ <span class="token function">cat</span> grafana.yml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: grafana\nspec:\n  template:\n    metadata:\n      labels:\n        tool: grafana\n      name: grafana-pod\n    spec:\n      containers:\n        - image: grafana/grafana\n          imagePullPolicy: IfNotPresent\n          name: grafana\n          ports:\n            - containerPort: <span class="token number">3000</span>\n              protocol: TCP\n\n$ kubectl apply <span class="token parameter variable">-f</span> grafana.yml\n\n<span class="token comment"># 创建Service</span>\n$ <span class="token function">cat</span> grafana-service.yml\napiVersion: v1\nkind: Service\nmetadata:\n  name: grafana\nspec:\n  internalTrafficPolicy: Cluster\n  ipFamilies:\n    - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n    - port: <span class="token number">3000</span>\n      protocol: TCP\n      targetPort: <span class="token number">3000</span>\n  selector:\n    tool: grafana\n  sessionAffinity: None\n  type: ClusterIP\n\n$ kubectl apply <span class="token parameter variable">-f</span> grafana-service.yml\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="可视化展示" tabindex="-1"><a class="header-anchor" href="#可视化展示" aria-hidden="true">#</a> 可视化展示</h2><p>访问Grafana：默认账户/密码：admin/admin <img src="https://img.kubesre.com/kubesre/20230913/22.png" alt="image.png"></p><p>配置Prometheus数据源： <img src="https://img.kubesre.com/kubesre/20230913/33.png" alt="image.png"> 导入模版查看数据： <img src="https://img.kubesre.com/kubesre/20230913/44.png" alt="image.png"></p>', 26);
const _hoisted_27 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache) {
  return openBlock(), createElementBlock("div", null, _hoisted_27);
}
const ruheshiyongPrometheusjiankongMongoDBjiqun_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "ruheshiyongPrometheusjiankongMongoDBjiqun.html.vue"]]);
export {
  ruheshiyongPrometheusjiankongMongoDBjiqun_html as default
};
