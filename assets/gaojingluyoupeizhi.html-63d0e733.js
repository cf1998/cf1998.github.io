import { _ as _export_sfc, r as resolveComponent, o as openBlock, c as createElementBlock, b as createBaseVNode, d as createTextVNode, e as createVNode, a as createStaticVNode } from "./app-53847742.js";
const _sfc_main = {};
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h2 id="上篇回顾" tabindex="-1"><a class="header-anchor" href="#上篇回顾" aria-hidden="true">#</a> 上篇回顾</h2><p>上篇内容我们主要是针对告警以及如何自定义告警规则做了演示，但是我们会发现告警不够清晰，例如如何根据不同的主机、业务艾特人员。本篇文章讲解如何设置告警路由。</p><h2 id="altermanager默认配置文件" tabindex="-1"><a class="header-anchor" href="#altermanager默认配置文件" aria-hidden="true">#</a> Altermanager默认配置文件</h2><p>通过控制台查看Alertmanager配置：</p><p><img src="https://img.kubesre.com/kubesre/20230825/1.png" alt=""></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>\n  <span class="token key atrule">resolve_timeout</span><span class="token punctuation">:</span> 5m    <span class="token comment"># 该参数定义了当Alertmanager持续多长时间未接收到告警后标记告警状态为resolved</span>\n  <span class="token key atrule">http_config</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token comment"># HTTP 配置，此处为空对象，表示没有特定的配置</span>\n  <span class="token key atrule">smtp_hello</span><span class="token punctuation">:</span> localhost  <span class="token comment"># SMTP 邮件发送时使用的 HELO 消息</span>\n  <span class="token key atrule">smtp_require_tls</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># SMTP 邮件发送是否需要使用 TLS</span>\n  <span class="token key atrule">pagerduty_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//events.pagerduty.com/v2/enqueue     <span class="token comment"># PagerDuty API URL</span>\n  <span class="token key atrule">opsgenie_api_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//api.opsgenie.com/                <span class="token comment"># Opsgenie API URL</span>\n  <span class="token key atrule">wechat_api_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//qyapi.weixin.qq.com/cgi<span class="token punctuation">-</span>bin/       <span class="token comment"># 微信企业号 API URL</span>\n  <span class="token key atrule">victorops_api_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//alert.victorops.com/integrations/generic/20131114/alert/  <span class="token comment"># VictorOps API URL</span>\n\n<span class="token key atrule">route</span><span class="token punctuation">:</span>\n  <span class="token key atrule">receiver</span><span class="token punctuation">:</span> Default  <span class="token comment"># 默认的接收器名称</span>\n  <span class="token key atrule">group_by</span><span class="token punctuation">:</span>         <span class="token comment"># 分组字段，用于将警报按照指定字段进行分组</span>\n  <span class="token punctuation">-</span> namespace       <span class="token comment"># 按照命名空间分组</span>\n  <span class="token key atrule">routes</span><span class="token punctuation">:</span>           <span class="token comment"># 路由规则列表</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">receiver</span><span class="token punctuation">:</span> Watchdog  <span class="token comment"># 接收器名称为 Watchdog 的路由规则</span>\n    <span class="token key atrule">match</span><span class="token punctuation">:</span>               <span class="token comment"># 匹配条件</span>\n      <span class="token key atrule">alertname</span><span class="token punctuation">:</span> Watchdog  <span class="token comment"># 匹配警报名称为 Watchdog 的警报</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">receiver</span><span class="token punctuation">:</span> Critical   <span class="token comment"># 接收器名称为 Critical 的路由规则</span>\n    <span class="token key atrule">match</span><span class="token punctuation">:</span>               <span class="token comment"># 匹配条件</span>\n      <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical  <span class="token comment"># 匹配严重程度为 critical 的警报</span>\n  <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 30s        <span class="token comment"># 在组内等待所配置的时间，如果同组内，30秒内出现相同报警，在一个组内发送报警。</span>\n  <span class="token key atrule">group_interval</span><span class="token punctuation">:</span> 5m     <span class="token comment"># 如果组内内容不变化，合并为一条警报信息，5m后发送。</span>\n  <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 12h   <span class="token comment"># 发送报警间隔，如果指定时间内没有修复，则重新发送报警。</span>\n\n<span class="token key atrule">inhibit_rules</span><span class="token punctuation">:</span>   <span class="token comment"># 抑制规则列表，用于控制警报传播的行为</span>\n<span class="token punctuation">-</span> <span class="token key atrule">source_match</span><span class="token punctuation">:</span>         <span class="token comment"># 源警报匹配条件</span>\n    <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical  <span class="token comment"># 源警报的严重程度为 critical</span>\n  <span class="token key atrule">target_match_re</span><span class="token punctuation">:</span>      <span class="token comment"># 目标警报匹配条件（使用正则表达式进行匹配）</span>\n    <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning<span class="token punctuation">|</span>info  <span class="token comment"># 目标警报的严重程度为 warning 或 info</span>\n  <span class="token key atrule">equal</span><span class="token punctuation">:</span>                <span class="token comment"># 需要匹配相等的字段</span>\n  <span class="token punctuation">-</span> namespace           <span class="token comment"># 命名空间字段需要相等</span>\n  <span class="token punctuation">-</span> alertname           <span class="token comment"># 警报名称字段需要相等</span>\n<span class="token punctuation">-</span> <span class="token key atrule">source_match</span><span class="token punctuation">:</span>         <span class="token comment"># 源警报匹配条件</span>\n    <span class="token key atrule">severity</span><span class="token punctuation">:</span> warning   <span class="token comment"># 源警报的严重程度为 warning</span>\n  <span class="token key atrule">target_match_re</span><span class="token punctuation">:</span>      <span class="token comment"># 目标警报匹配条件（使用正则表达式进行匹配）</span>\n    <span class="token key atrule">severity</span><span class="token punctuation">:</span> info      <span class="token comment"># 目标警报的严重程度为 info</span>\n  <span class="token key atrule">equal</span><span class="token punctuation">:</span>                <span class="token comment"># 需要匹配相等的字段</span>\n  <span class="token punctuation">-</span> namespace           <span class="token comment"># 命名空间字段需要相等</span>\n  <span class="token punctuation">-</span> alertname           <span class="token comment"># 警报名称字段需要相等</span>\n\n<span class="token key atrule">receivers</span><span class="token punctuation">:</span>     <span class="token comment"># 接收器列表</span>\n<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Default  <span class="token comment"># 默认接收器</span>\n<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Watchdog  <span class="token comment"># Watchdog 接收器</span>\n<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Critical  <span class="token comment"># Critical 接收器</span>\n\n<span class="token key atrule">templates</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>   <span class="token comment"># 模板列表，此处为空列表，表示没有定义任何模板</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="案例介绍" tabindex="-1"><a class="header-anchor" href="#案例介绍" aria-hidden="true">#</a> 案例介绍</h2><p>基于自定义路由告警，我们依旧使用<strong>prometheusAlert</strong>作为告警渠道，为了方便区分来自不同路由的告警，我们这里使用艾特不同的人员进行区分</p><h2 id="环境概述" tabindex="-1"><a class="header-anchor" href="#环境概述" aria-hidden="true">#</a> 环境概述</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectl get nodes </span>\nNAME               STATUS   ROLES                  AGE   VERSION\nk8s-master-50.57   Ready    control-plane,master   96d   v1.20.5\nk8s-node-50.58     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 96d   v1.20.5\nk8s-node-50.59     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 96d   v1.20.5\n\n<span class="token comment"># kubectl get pod -n monitoring </span>\nNAME                                  READY   STATUS    RESTARTS   AGE\nalertmanager-main-0                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nalertmanager-main-1                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nalertmanager-main-2                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nblackbox-exporter-55c457d5fb-5m7ql    <span class="token number">3</span>/3     Running   <span class="token number">0</span>          8d\ngrafana-9df57cdc4-gpzsq               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nkube-state-metrics-56dbb74497-gpkn9   <span class="token number">3</span>/3     Running   <span class="token number">0</span>          8d\nnode-exporter-4wl6d                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nnode-exporter-b4595                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nnode-exporter-g4l99                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nprometheus-adapter-59df95d9f5-tnt4w   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nprometheus-adapter-59df95d9f5-xhz5v   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nprometheus-k8s-0                      <span class="token number">2</span>/2     Running   <span class="token number">1</span>          8d\nprometheus-k8s-1                      <span class="token number">2</span>/2     Running   <span class="token number">1</span>          10m\nprometheus-operator-c46b8b7c9-mg9cv   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="快速开始" tabindex="-1"><a class="header-anchor" href="#快速开始" aria-hidden="true">#</a> 快速开始</h2><p>创建Altermanager配置文件</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">## Alertmanager 配置文件</span>\n<span class="token key atrule">global</span><span class="token punctuation">:</span>\n  <span class="token key atrule">resolve_timeout</span><span class="token punctuation">:</span> 1m  <span class="token comment"># 该参数定义了当Alertmanager持续多长时间未接收到告警后标记告警状态为resolved（已解决）</span>\n<span class="token comment"># 路由分组</span>\n<span class="token key atrule">route</span><span class="token punctuation">:</span>\n  <span class="token key atrule">receiver</span><span class="token punctuation">:</span> devops  <span class="token comment"># 默认的接收器名称</span>\n  <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 30s <span class="token comment"># 在组内等待所配置的时间，如果同组内，30秒内出现相同报警，在一个组内发送报警。</span>\n  <span class="token key atrule">group_interval</span><span class="token punctuation">:</span> 1m <span class="token comment"># 如果组内内容不变化，合并为一条警报信息，5m后发送。</span>\n  <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 1m <span class="token comment"># 发送报警间隔，如果指定时间内没有修复，则重新发送报警。</span>\n  <span class="token key atrule">group_by</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>alertname<span class="token punctuation">,</span>instance<span class="token punctuation">]</span>  <span class="token comment"># 报警分组</span>\n  <span class="token key atrule">routes</span><span class="token punctuation">:</span>  <span class="token comment"># 子路由的匹配设置</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span> <span class="token comment"># 匹配</span>\n          <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical\n        <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">&#39;ops-critical&#39;</span>\n        <span class="token key atrule">continue</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">match_re</span><span class="token punctuation">:</span> <span class="token comment"># 正则匹配</span>\n          <span class="token key atrule">severity</span><span class="token punctuation">:</span> error<span class="token punctuation">|</span>info\n        <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">&#39;ops-err&#39;</span>\n        <span class="token key atrule">continue</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n<span class="token comment"># 接收器指定发送人以及发送渠道</span>\n<span class="token key atrule">receivers</span><span class="token punctuation">:</span>\n<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> devops\n  <span class="token key atrule">webhook_configs</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//prometheusalert.monitoring.svc<span class="token punctuation">:</span>8080/prometheusalert<span class="token punctuation">?</span>type=dd<span class="token important">&amp;tpl=prometheus-dd&amp;ddurl=https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxx&amp;at=18438613802</span>\n    <span class="token key atrule">send_resolved</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ops<span class="token punctuation">-</span>critical\n  <span class="token key atrule">webhook_configs</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//prometheusalert.monitoring.svc<span class="token punctuation">:</span>8080/prometheusalert<span class="token punctuation">?</span>type=dd<span class="token important">&amp;tpl=prometheus-dd&amp;ddurl=https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxx&amp;at=18538702120</span>\n<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ops<span class="token punctuation">-</span>err\n  <span class="token key atrule">webhook_configs</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//prometheusalert.monitoring.svc<span class="token punctuation">:</span>8080/prometheusalert<span class="token punctuation">?</span>type=dd<span class="token important">&amp;tpl=prometheus-dd&amp;ddurl=https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxxxx&amp;at=18438613801</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改Alertmanager配置文件</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># cat alertmanager-secret.yaml</span>\n<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1\n<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret\n<span class="token key atrule">metadata</span><span class="token punctuation">:</span>\n  <span class="token key atrule">labels</span><span class="token punctuation">:</span>\n    <span class="token key atrule">alertmanager</span><span class="token punctuation">:</span> main\n    <span class="token key atrule">app.kubernetes.io/component</span><span class="token punctuation">:</span> alert<span class="token punctuation">-</span>router\n    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> alertmanager\n    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>prometheus\n    <span class="token key atrule">app.kubernetes.io/version</span><span class="token punctuation">:</span> 0.21.0\n  <span class="token key atrule">name</span><span class="token punctuation">:</span> alertmanager<span class="token punctuation">-</span>main\n  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> monitoring\n<span class="token key atrule">stringData</span><span class="token punctuation">:</span>\n  <span class="token key atrule">alertmanager.yaml</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>\n    <span class="token comment">## Alertmanager 配置文件</span>\n    <span class="token key atrule">global</span><span class="token punctuation">:</span>\n      <span class="token key atrule">resolve_timeout</span><span class="token punctuation">:</span> 1m  <span class="token comment"># 该参数定义了当Alertmanager持续多长时间未接收到告警后标记告警状态为resolved（已解决）</span>\n    <span class="token comment"># 路由分组</span>\n    <span class="token key atrule">route</span><span class="token punctuation">:</span>\n      <span class="token key atrule">receiver</span><span class="token punctuation">:</span> devops  <span class="token comment"># 默认的接收器名称</span>\n      <span class="token key atrule">group_wait</span><span class="token punctuation">:</span> 30s <span class="token comment"># 在组内等待所配置的时间，如果同组内，30秒内出现相同报警，在一个组内发送报警。</span>\n      <span class="token key atrule">group_interval</span><span class="token punctuation">:</span> 1m <span class="token comment"># 如果组内内容不变化，合并为一条警报信息，5m后发送。</span>\n      <span class="token key atrule">repeat_interval</span><span class="token punctuation">:</span> 1m <span class="token comment"># 发送报警间隔，如果指定时间内没有修复，则重新发送报警。</span>\n      <span class="token key atrule">group_by</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>alertname<span class="token punctuation">,</span>instance<span class="token punctuation">]</span>  <span class="token comment"># 报警分组</span>\n      <span class="token key atrule">routes</span><span class="token punctuation">:</span>  <span class="token comment"># 子路由的匹配设置</span>\n          <span class="token punctuation">-</span> <span class="token key atrule">match</span><span class="token punctuation">:</span> <span class="token comment"># 匹配</span>\n              <span class="token key atrule">severity</span><span class="token punctuation">:</span> critical\n            <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">&#39;ops-critical&#39;</span>\n            <span class="token key atrule">continue</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n          <span class="token punctuation">-</span> <span class="token key atrule">match_re</span><span class="token punctuation">:</span> <span class="token comment"># 正则匹配</span>\n              <span class="token key atrule">severity</span><span class="token punctuation">:</span> error<span class="token punctuation">|</span>info\n            <span class="token key atrule">receiver</span><span class="token punctuation">:</span> <span class="token string">&#39;ops-err&#39;</span>\n            <span class="token key atrule">continue</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n    <span class="token comment"># 接收器指定发送人以及发送渠道</span>\n    <span class="token key atrule">receivers</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> devops\n      <span class="token key atrule">webhook_configs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//prometheusalert.monitoring.svc<span class="token punctuation">:</span>8080/prometheusalert<span class="token punctuation">?</span>type=dd<span class="token important">&amp;tpl=prometheus-dd&amp;ddurl=https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxx&amp;at=18438613802</span>\n        <span class="token key atrule">send_resolved</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ops<span class="token punctuation">-</span>critical\n      <span class="token key atrule">webhook_configs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//prometheusalert.monitoring.svc<span class="token punctuation">:</span>8080/prometheusalert<span class="token punctuation">?</span>type=dd<span class="token important">&amp;tpl=prometheus-dd&amp;ddurl=https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxx&amp;at=18538702120</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ops<span class="token punctuation">-</span>err\n      <span class="token key atrule">webhook_configs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//prometheusalert.monitoring.svc<span class="token punctuation">:</span>8080/prometheusalert<span class="token punctuation">?</span>type=dd<span class="token important">&amp;tpl=prometheus-dd&amp;ddurl=https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxxxxxxxxxxxxxxxxx&amp;at=18438613801</span>\n<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque\n\n<span class="token comment">#  kubectl   apply   -f   alertmanager-secret.yaml</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>该yaml中的<code>alertmanager.yaml</code>中的内容使用的正是我们创建的内容，别忘记altermanager重新加载一下哦</p></blockquote><h3 id="匹配告警路由" tabindex="-1"><a class="header-anchor" href="#匹配告警路由" aria-hidden="true">#</a> 匹配告警路由</h3>', 17);
const _hoisted_18 = {
  href: "https://prometheus.io/webtools/alerting/routing-tree-editor/",
  target: "_blank",
  rel: "noopener noreferrer"
};
const _hoisted_19 = /* @__PURE__ */ createStaticVNode('<p><img src="https://img.kubesre.com/kubesre/20230825/2.png" alt=""></p><p><img src="https://img.kubesre.com/kubesre/20230825/3.png" alt=""></p><p><img src="https://img.kubesre.com/kubesre/20230825/4.png" alt=""></p><p>经过我们路由的匹配，发现当标签匹配不到时，会使用默认的路由。</p><h3 id="查看钉钉告警" tabindex="-1"><a class="header-anchor" href="#查看钉钉告警" aria-hidden="true">#</a> 查看钉钉告警</h3><p><img src="https://img.kubesre.com/kubesre/20230825/5.png" alt=""></p><p>告警级别为<code>critical</code>，使用<code>ops-critical</code>路由进行告警，艾特人员为<code>18538xxxx</code></p><blockquote><p>注：忽略该告警内容中的@没有名字，应为不存在该用户</p></blockquote><p><img src="https://img.kubesre.com/kubesre/20230825/6.png" alt=""></p><p>告警级别为<code>warning</code>，使用<code>devops</code>默认路由进行告警，艾特人员为<code>张行雷</code>手机号为：<code>18538xxxx</code></p><p><img src="https://img.kubesre.com/kubesre/20230825/7.png" alt=""></p><p>告警级别为<code>info</code>，使用<code>ops-err</code>路由进行告警，艾特人员手机号为：<code>18538xxxx</code></p><blockquote><p>注：忽略该告警内容中的@没有名字，应为不存在该用户</p></blockquote><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>本篇文章主要讲解了如何配置告警路由进行提醒不同人员，当然这种情况也是有瑕疵的。下期内容：告警认领</p>', 15);
function _sfc_render(_ctx, _cache) {
  const _component_ExternalLinkIcon = resolveComponent("ExternalLinkIcon");
  return openBlock(), createElementBlock("div", null, [
    _hoisted_1,
    createBaseVNode("p", null, [
      createTextVNode("这里我们通过 "),
      createBaseVNode("a", _hoisted_18, [
        createTextVNode("可视化路由"),
        createVNode(_component_ExternalLinkIcon)
      ]),
      createTextVNode("  树来进行手动匹配规则验证")
    ]),
    _hoisted_19
  ]);
}
const gaojingluyoupeizhi_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "gaojingluyoupeizhi.html.vue"]]);
export {
  gaojingluyoupeizhi_html as default
};
