import { _ as _export_sfc, o as openBlock, c as createElementBlock, a as createStaticVNode } from "./app-18c0c063.js";
const _sfc_main = {};
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景" aria-hidden="true">#</a> 背景</h2><p>在大规模集群场景中，部分服务需要通过公网Ingress对外提供服务访问，但是有部分服务只对内提供服务，不允许使用公网访问，仅支持内部服务间调用，此时可以通过部署两套独立的Ingress来实现，一套支持公网访问，一套仅支持内网访问。接下来，我们通过最佳实践进行实现喽！</p><h2 id="架构图" tabindex="-1"><a class="header-anchor" href="#架构图" aria-hidden="true">#</a> 架构图</h2><p><img src="https://img.kubesre.com/kubesre/20230823/1.png" alt="ingress多个部署.png"></p><p>最佳实践说明：</p><ul><li>在Kubernetes集群中，部署两个Ingress控制器分别为int-ingress-nginx和ingress-nginx</li><li>int-ingress-nginx负责承接内部流量</li><li>ingress-nginx负责承接外部流量</li></ul><h2 id="ingress-配置参数说明" tabindex="-1"><a class="header-anchor" href="#ingress-配置参数说明" aria-hidden="true">#</a> Ingress 配置参数说明</h2><ul><li>controller.image.repository：ingress-nginx镜像地址</li><li>controller.image.registry：镜像仓库域名，该参数需要与controller.image.image同时填写</li><li>controller.image.image：镜像名称。该参数需要与controller.image.registry同时填写</li><li>controller.image.tag：ingress-nginx镜像版本，可通过已安装插件实例的YAML文件查看，需要根据插件版本进行替换</li><li>controller.ingressClass：设置Ingress Controller所对应的IngressClass的名称，同一个集群中不同套Ingress Controller名称必须唯一</li><li>controller.ingressClassResource.name：需要与ingressClass值相同</li><li>controller.ingressClassResource.controllerValue：同一个集群中不同套Ingress Controller的监听标识必须唯一，且不能设置为k8s.io/ingress-nginx，（k8s.io/ingress-nginx是默认Nginx Ingress Controller的监听标识）。</li><li>controller.resources.requests.cpu：Nginx controller的CPU资源申请值，可根据需求自定义</li><li>controller.resources.requests.memory：Nginx controller的内存资源申请值，可根据需求自定义</li><li>defaultBackend.image.tag：default-backend镜像版本</li><li>controller.admissionWebhooks.enabled：是否开启admissionWebhooks，可以对Ingress对象进行有效性校验，避免因配置错误导致ingress-controller不断重新加载资源，导致业务中断。</li><li>controller.admissionWebhooks.patch.enabled：同上，表示是否开启admissionWebhooks。此处设置为false。</li></ul><p><strong>Ingress控制器CRD的关联关系：</strong></p><p><img src="https://img.kubesre.com/kubesre/20230823/2.png" alt="image.png"></p><p>说明：</p><ul><li>Ingress-controller启动的时候指定controller-class名称</li><li>通过IngressClass CRD对象进行声明并与Ingress-controller进行绑定</li><li>Ingress CRD对象关联IngressClassName</li></ul><h2 id="部署多个ingress-nginx" tabindex="-1"><a class="header-anchor" href="#部署多个ingress-nginx" aria-hidden="true">#</a> 部署多个Ingress Nginx</h2><p>本案例通过helm进行安装:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 配置helm仓库</span>\n$ helm repo <span class="token function">add</span> ingress-nginx https://kubernetes.github.io/ingress-nginx\n<span class="token string">&quot;ingress-nginx&quot;</span> has been added to your repositories\n$ helm repo update\nHang tight <span class="token keyword">while</span> we grab the latest from your chart repositories<span class="token punctuation">..</span>.\n<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">&quot;higress.io&quot;</span> chart repository\n<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">&quot;ingress-nginx&quot;</span> chart repository\nUpdate Complete. ⎈Happy Helming<span class="token operator">!</span>⎈\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装Ingress-nginx（外网流量）：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ helm <span class="token parameter variable">-n</span> ingress-nginx <span class="token function">install</span> ingress-nginx ingress-nginx/ingress-nginx --create-namespace <span class="token parameter variable">--set</span> <span class="token assign-left variable">controller.ingressClass</span><span class="token operator">=</span>ingress-nginx,controller.ingressClassResource.name<span class="token operator">=</span>ingress-nginx\nNAME: ingress-nginx\nLAST DEPLOYED: Tue Aug <span class="token number">22</span> <span class="token number">14</span>:26:25 <span class="token number">2023</span>\nNAMESPACE: ingress-nginx\nSTATUS: deployed\nREVISION: <span class="token number">1</span>\nTEST SUITE: None\nNOTES:\nThe ingress-nginx controller has been installed.\nIt may take a few minutes <span class="token keyword">for</span> the LoadBalancer IP to be available.\nYou can <span class="token function">watch</span> the status by running <span class="token string">&#39;kubectl --namespace ingress-nginx get services -o wide -w ingress-nginx-controller&#39;</span>\n\nAn example Ingress that makes use of the controller:\n  apiVersion: networking.k8s.io/v1\n  kind: Ingress\n  metadata:\n    name: example\n    namespace: foo\n  spec:\n    ingressClassName: ingress-nginx\n    rules:\n      - host: www.example.com\n        http:\n          paths:\n            - pathType: Prefix\n              backend:\n                service:\n                  name: exampleService\n                  port:\n                    number: <span class="token number">80</span>\n              path: /\n    <span class="token comment"># This section is only required if TLS is to be enabled for the Ingress</span>\n    tls:\n      - hosts:\n        - www.example.com\n        secretName: example-tls\n\nIf TLS is enabled <span class="token keyword">for</span> the Ingress, a Secret containing the certificate and key must also be provided:\n\n  apiVersion: v1\n  kind: Secret\n  metadata:\n    name: example-tls\n    namespace: foo\n  data:\n    tls.crt: <span class="token operator">&lt;</span>base64 encoded cert<span class="token operator">&gt;</span>\n    tls.key: <span class="token operator">&lt;</span>base64 encoded key<span class="token operator">&gt;</span>\n  type: kubernetes.io/tls\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装int-ingress-nginx（内部流量）：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ helm <span class="token parameter variable">-n</span> int-ingress-nginx <span class="token function">install</span> int-ingress-nginx ingress-nginx/ingress-nginx --create-namespace <span class="token parameter variable">--set</span> <span class="token assign-left variable">controller.ingressClass</span><span class="token operator">=</span>int-ingress-nginx,controller.ingressClassResource.name<span class="token operator">=</span>int-ingress-nginx\nNAME: int-ingress-nginx\nLAST DEPLOYED: Tue Aug <span class="token number">22</span> <span class="token number">14</span>:29:00 <span class="token number">2023</span>\nNAMESPACE: int-ingress-nginx\nSTATUS: deployed\nREVISION: <span class="token number">1</span>\nTEST SUITE: None\nNOTES:\nThe ingress-nginx controller has been installed.\nIt may take a few minutes <span class="token keyword">for</span> the LoadBalancer IP to be available.\nYou can <span class="token function">watch</span> the status by running <span class="token string">&#39;kubectl --namespace int-ingress-nginx get services -o wide -w int-ingress-nginx-controller&#39;</span>\n\nAn example Ingress that makes use of the controller:\n  apiVersion: networking.k8s.io/v1\n  kind: Ingress\n  metadata:\n    name: example\n    namespace: foo\n  spec:\n    ingressClassName: int-ingress-nginx\n    rules:\n      - host: www.example.com\n        http:\n          paths:\n            - pathType: Prefix\n              backend:\n                service:\n                  name: exampleService\n                  port:\n                    number: <span class="token number">80</span>\n              path: /\n    <span class="token comment"># This section is only required if TLS is to be enabled for the Ingress</span>\n    tls:\n      - hosts:\n        - www.example.com\n        secretName: example-tls\n\nIf TLS is enabled <span class="token keyword">for</span> the Ingress, a Secret containing the certificate and key must also be provided:\n\n  apiVersion: v1\n  kind: Secret\n  metadata:\n    name: example-tls\n    namespace: foo\n  data:\n    tls.crt: <span class="token operator">&lt;</span>base64 encoded cert<span class="token operator">&gt;</span>\n    tls.key: <span class="token operator">&lt;</span>base64 encoded key<span class="token operator">&gt;</span>\n  type: kubernetes.io/tls\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ kubectl get pods <span class="token parameter variable">-A</span>\nNAMESPACE            NAME                                           READY   STATUS    RESTARTS   AGE\ningress-nginx        ingress-nginx-controller-5db5867dcf-v9pfv      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3m\nint-ingress-nginx    int-ingress-nginx-controller-54585986c-pp9v4   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          26s\nkube-system          coredns-5d78c9869d-5m4t5                       <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nkube-system          coredns-5d78c9869d-bs7s4                       <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nkube-system          etcd-kind-control-plane                        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nkube-system          kindnet-5cxpf                                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nkube-system          kube-apiserver-kind-control-plane              <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nkube-system          kube-controller-manager-kind-control-plane     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nkube-system          kube-proxy-c9ztm                               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nkube-system          kube-scheduler-kind-control-plane              <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\nlocal-path-storage   local-path-provisioner-6bc4bddd6b-7v8fm        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4d22h\n$ kubectl get ingressClass\nNAME                CONTROLLER             PARAMETERS   AGE\ningress-nginx       k8s.io/ingress-nginx   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       3m57s\nint-ingress-nginx   k8s.io/ingress-nginx   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>       83s\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到此为止，多个ingress安装成功，接下来，咱们可以安装demo进行验证了！</p><h2 id="部署示例服务" tabindex="-1"><a class="header-anchor" href="#部署示例服务" aria-hidden="true">#</a> 部署示例服务</h2><ul><li>Auth服务：负责用户登陆授权返回Token</li><li>Demo服务：负责认证通过后访问的微服务</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 部署Auth服务</span>\n$ <span class="token function">cat</span> auth.yml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: auth\n  labels:\n    app: auth\nspec:\n  replicas: <span class="token number">1</span>\n  selector:\n    matchLabels:\n      app: auth\n  template:\n    metadata:\n      labels:\n        app: auth\n    spec:\n      containers:\n      - name: auth\n        imagePullPolicy: Always\n        image: registry.cn-shanghai.aliyuncs.com/kubesre01/auth:v1\n        ports:\n        - containerPort: <span class="token number">8080</span>\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: auth-svc\nspec:\n  type: ClusterIP\n  selector:\n    app: auth\n  ports:\n    - port: <span class="token number">8080</span>\n      targetPort: <span class="token number">8080</span>\n$ kubectl apply <span class="token parameter variable">-f</span> auth.yml\ndeployment.apps/auth unchanged\nservice/auth-svc unchanged\n\n\n<span class="token comment"># 部署demo服务</span>\n$  <span class="token function">cat</span> demo.yml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: demo\n  labels:\n    app: demo\nspec:\n  replicas: <span class="token number">1</span>\n  selector:\n    matchLabels:\n      app: demo\n  template:\n    metadata:\n      labels:\n        app: demo\n    spec:\n      containers:\n      - name: demo\n        imagePullPolicy: Always\n        image: registry.cn-shanghai.aliyuncs.com/kubesre01/demo:v1\n        ports:\n        - containerPort: <span class="token number">8080</span>\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: demo-svc\nspec:\n  type: ClusterIP\n  selector:\n    app: demo\n  ports:\n    - port: <span class="token number">8080</span>\n      targetPort: <span class="token number">8080</span>\n\n$ kubectl apply <span class="token parameter variable">-f</span> demo.yml\ndeployment.apps/demo unchanged\nservice/demo-svc unchanged\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="验证" tabindex="-1"><a class="header-anchor" href="#验证" aria-hidden="true">#</a> 验证</h2><p>创建内部流量的Ingress资源对象：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">cat</span> ingress.yml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo\nspec:\n  rules:\n  - host: demo.kubesre.com\n    http:\n      paths:\n      - path: /info\n        pathType: Prefix\n        backend:\n          service:\n            name: demo-svc\n            port:\n              number: <span class="token number">8080</span>\n  ingressClassName: int-ingress-nginx <span class="token comment"># 指定内部流量Ingress控制器</span>\n  \n$ kubectl apply <span class="token parameter variable">-f</span> ingress.yml\ningress.networking.k8s.io/demo created\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问验证：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 向内部流量Ingress发送请求</span>\n$ <span class="token function">curl</span> demo.kubesre.com/info \n<span class="token punctuation">{</span><span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;云原生运维圈！&quot;</span><span class="token punctuation">}</span>\n\n<span class="token comment"># 查看内部流量INgress日志进行确认</span>\n $ kubectl logs <span class="token parameter variable">-n</span> int-ingress-nginx <span class="token parameter variable">-f</span> int-ingress-nginx-controller-54585986c-pp9v4\n-------------------------------------------------------------------------------\nNGINX Ingress controller\n  Release:       v1.8.1\n  Build:         dc88dce9ea5e700f3301d16f971fa17c6cfe757d\n  Repository:    https://github.com/kubernetes/ingress-nginx\n  nginx version: nginx/1.21.6\n\n-------------------------------------------------------------------------------\n\nW0822 06:29:03.903208      <span class="token number">10</span> client_config.go:618<span class="token punctuation">]</span> Neither <span class="token parameter variable">--kubeconfig</span> nor <span class="token parameter variable">--master</span> was specified.  Using the inClusterConfig.  This might not work.\nI0822 06:29:03.903300      <span class="token number">10</span> main.go:209<span class="token punctuation">]</span> <span class="token string">&quot;Creating API client&quot;</span> <span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token string">&quot;https://10.96.0.1:443&quot;</span>\nI0822 06:29:03.906676      <span class="token number">10</span> main.go:253<span class="token punctuation">]</span> <span class="token string">&quot;Running in Kubernetes cluster&quot;</span> <span class="token assign-left variable">major</span><span class="token operator">=</span><span class="token string">&quot;1&quot;</span> <span class="token assign-left variable">minor</span><span class="token operator">=</span><span class="token string">&quot;27&quot;</span> <span class="token assign-left variable">git</span><span class="token operator">=</span><span class="token string">&quot;v1.27.3&quot;</span> <span class="token assign-left variable">state</span><span class="token operator">=</span><span class="token string">&quot;clean&quot;</span> <span class="token assign-left variable">commit</span><span class="token operator">=</span><span class="token string">&quot;25b4e43193bcda6c7328a6d147b1fb73a33f1598&quot;</span> <span class="token assign-left variable">platform</span><span class="token operator">=</span><span class="token string">&quot;linux/arm64&quot;</span>\nI0822 06:29:03.989381      <span class="token number">10</span> main.go:104<span class="token punctuation">]</span> <span class="token string">&quot;SSL fake certificate created&quot;</span> <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">&quot;/etc/ingress-controller/ssl/default-fake-certificate.pem&quot;</span>\nI0822 06:29:03.999403      <span class="token number">10</span> ssl.go:533<span class="token punctuation">]</span> <span class="token string">&quot;loading tls certificate&quot;</span> <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/cert&quot;</span> <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/key&quot;</span>\nI0822 06:29:04.004242      <span class="token number">10</span> nginx.go:261<span class="token punctuation">]</span> <span class="token string">&quot;Starting NGINX Ingress controller&quot;</span>\nI0822 06:29:04.007613      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;ConfigMap&quot;</span>, Namespace:<span class="token string">&quot;int-ingress-nginx&quot;</span>, Name:<span class="token string">&quot;int-ingress-nginx-controller&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;378c8763-6969-4a5b-8296-3de95dedd962&quot;</span>, APIVersion:<span class="token string">&quot;v1&quot;</span>, ResourceVersion:<span class="token string">&quot;135147&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;CREATE&#39;</span> ConfigMap int-ingress-nginx/int-ingress-nginx-controller\nI0822 06:29:05.206429      <span class="token number">10</span> nginx.go:304<span class="token punctuation">]</span> <span class="token string">&quot;Starting NGINX process&quot;</span>\nI0822 06:29:05.206811      <span class="token number">10</span> leaderelection.go:248<span class="token punctuation">]</span> attempting to acquire leader lease int-ingress-nginx/int-ingress-nginx-leader<span class="token punctuation">..</span>.\nI0822 06:29:05.207155      <span class="token number">10</span> nginx.go:324<span class="token punctuation">]</span> <span class="token string">&quot;Starting validation webhook&quot;</span> <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">&quot;:8443&quot;</span> <span class="token assign-left variable">certPath</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/cert&quot;</span> <span class="token assign-left variable">keyPath</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/key&quot;</span>\nI0822 06:29:05.208516      <span class="token number">10</span> controller.go:190<span class="token punctuation">]</span> <span class="token string">&quot;Configuration changes detected, backend reload required&quot;</span>\nI0822 06:29:05.220682      <span class="token number">10</span> leaderelection.go:258<span class="token punctuation">]</span> successfully acquired lease int-ingress-nginx/int-ingress-nginx-leader\nI0822 06:29:05.221284      <span class="token number">10</span> status.go:84<span class="token punctuation">]</span> <span class="token string">&quot;New leader elected&quot;</span> <span class="token assign-left variable">identity</span><span class="token operator">=</span><span class="token string">&quot;int-ingress-nginx-controller-54585986c-pp9v4&quot;</span>\nI0822 06:29:05.283791      <span class="token number">10</span> controller.go:207<span class="token punctuation">]</span> <span class="token string">&quot;Backend successfully reloaded&quot;</span>\nI0822 06:29:05.283853      <span class="token number">10</span> controller.go:218<span class="token punctuation">]</span> <span class="token string">&quot;Initial sync, sleeping for 1 second&quot;</span>\nI0822 06:29:05.283888      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Pod&quot;</span>, Namespace:<span class="token string">&quot;int-ingress-nginx&quot;</span>, Name:<span class="token string">&quot;int-ingress-nginx-controller-54585986c-pp9v4&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;26b115bc-5d52-47fa-927d-71d8ef8eaa54&quot;</span>, APIVersion:<span class="token string">&quot;v1&quot;</span>, ResourceVersion:<span class="token string">&quot;135176&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;RELOAD&#39;</span> NGINX reload triggered due to a change <span class="token keyword">in</span> configuration\nW0822 07:54:01.251833      <span class="token number">10</span> controller.go:328<span class="token punctuation">]</span> ignoring ingress demo-redirect <span class="token keyword">in</span> default based on annotation <span class="token builtin class-name">:</span> no object matching key <span class="token string">&quot;nginx&quot;</span> <span class="token keyword">in</span> <span class="token builtin class-name">local</span> store\nI0822 07:54:01.251929      <span class="token number">10</span> main.go:110<span class="token punctuation">]</span> <span class="token string">&quot;successfully validated configuration, accepting&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo-redirect&quot;</span>\nI0822 07:54:01.255287      <span class="token number">10</span> store.go:428<span class="token punctuation">]</span> <span class="token string">&quot;Ignoring ingress because of error while validating ingress class&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo-redirect&quot;</span> <span class="token assign-left variable">error</span><span class="token operator">=</span><span class="token string">&quot;no object matching key <span class="token entity" title="\\&quot;">\\&quot;</span>nginx<span class="token entity" title="\\&quot;">\\&quot;</span> in local store&quot;</span>\nI0822 07:54:14.491144      <span class="token number">10</span> store.go:398<span class="token punctuation">]</span> <span class="token string">&quot;Ignoring ingress because of error while validating ingress class&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo-redirect&quot;</span> <span class="token assign-left variable">error</span><span class="token operator">=</span><span class="token string">&quot;no object matching key <span class="token entity" title="\\&quot;">\\&quot;</span>nginx<span class="token entity" title="\\&quot;">\\&quot;</span> in local store&quot;</span>\nI0822 07:59:03.354868      <span class="token number">10</span> admission.go:149<span class="token punctuation">]</span> processed ingress via admission controller <span class="token punctuation">{</span>testedIngressLength:1 testedIngressTime:0.06s renderingIngressLength:1 renderingIngressTime:0.001s admissionTime:25.5kBs testedConfigurationSize:0.061<span class="token punctuation">}</span>\nI0822 07:59:03.354915      <span class="token number">10</span> main.go:110<span class="token punctuation">]</span> <span class="token string">&quot;successfully validated configuration, accepting&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo&quot;</span>\nI0822 07:59:03.358113      <span class="token number">10</span> store.go:432<span class="token punctuation">]</span> <span class="token string">&quot;Found valid IngressClass&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo&quot;</span> <span class="token assign-left variable">ingressclass</span><span class="token operator">=</span><span class="token string">&quot;int-ingress-nginx&quot;</span>\nI0822 07:59:03.358399      <span class="token number">10</span> controller.go:190<span class="token punctuation">]</span> <span class="token string">&quot;Configuration changes detected, backend reload required&quot;</span>\nI0822 07:59:03.358596      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Ingress&quot;</span>, Namespace:<span class="token string">&quot;default&quot;</span>, Name:<span class="token string">&quot;demo&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;64bbeb49-e705-423c-9f86-1fcbf066f6ce&quot;</span>, APIVersion:<span class="token string">&quot;networking.k8s.io/v1&quot;</span>, ResourceVersion:<span class="token string">&quot;143749&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;Sync&#39;</span> Scheduled <span class="token keyword">for</span> <span class="token function">sync</span>\nI0822 07:59:03.402693      <span class="token number">10</span> controller.go:207<span class="token punctuation">]</span> <span class="token string">&quot;Backend successfully reloaded&quot;</span>\nI0822 07:59:03.402902      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Pod&quot;</span>, Namespace:<span class="token string">&quot;int-ingress-nginx&quot;</span>, Name:<span class="token string">&quot;int-ingress-nginx-controller-54585986c-pp9v4&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;26b115bc-5d52-47fa-927d-71d8ef8eaa54&quot;</span>, APIVersion:<span class="token string">&quot;v1&quot;</span>, ResourceVersion:<span class="token string">&quot;135176&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;RELOAD&#39;</span> NGINX reload triggered due to a change <span class="token keyword">in</span> configuration\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:07:28 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /info HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">35</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">84</span> <span class="token number">0.010</span> <span class="token punctuation">[</span>default-demo-svc-8080<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">10.244</span>.0.27:8080 <span class="token number">35</span> <span class="token number">0.010</span> <span class="token number">200</span> 3364c68cbd67906e432a3428f175034\n\n\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:07:45 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /info HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">35</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">84</span> <span class="token number">0.007</span> <span class="token punctuation">[</span>default-demo-svc-8080<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">10.244</span>.0.27:8080 <span class="token number">35</span> <span class="token number">0.006</span> <span class="token number">200</span> 02dc2168565fce906af19ad33949d836\n<span class="token comment"># 可以看出是否流量进入的说明验证成功了</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建外部流量的Ingress资源对象：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">cat</span> ingress.yml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: auth\nspec:\n  rules:\n  - host: demo.kubesre.com\n    http:\n      paths:\n      - path: /login\n        pathType: Prefix\n        backend:\n          service:\n            name: auth-svc\n            port:\n              number: <span class="token number">8080</span>\n  ingressClassName: ingress-nginx <span class="token comment"># 指定外部流量Ingress控制器</span>\n  \n$ kubectl apply <span class="token parameter variable">-f</span> ingress.yml\ningress.networking.k8s.io/auth created\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 向外部流量Ingress发送请求</span>\n$ <span class="token function">curl</span> demo.kubesre.com/login\n<span class="token number">404</span> page not found\n\n<span class="token comment"># 查看外部流量INgress日志进行确认</span>\nkubectl logs <span class="token parameter variable">-f</span> <span class="token parameter variable">-n</span> ingress-nginx ingress-nginx-controller-5db5867dcf-v9pfv\n-------------------------------------------------------------------------------\nNGINX Ingress controller\n  Release:       v1.8.1\n  Build:         dc88dce9ea5e700f3301d16f971fa17c6cfe757d\n  Repository:    https://github.com/kubernetes/ingress-nginx\n  nginx version: nginx/1.21.6\n\n-------------------------------------------------------------------------------\n\nW0822 06:26:30.280533      <span class="token number">10</span> client_config.go:618<span class="token punctuation">]</span> Neither <span class="token parameter variable">--kubeconfig</span> nor <span class="token parameter variable">--master</span> was specified.  Using the inClusterConfig.  This might not work.\nI0822 06:26:30.280652      <span class="token number">10</span> main.go:209<span class="token punctuation">]</span> <span class="token string">&quot;Creating API client&quot;</span> <span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token string">&quot;https://10.96.0.1:443&quot;</span>\nI0822 06:26:30.284480      <span class="token number">10</span> main.go:253<span class="token punctuation">]</span> <span class="token string">&quot;Running in Kubernetes cluster&quot;</span> <span class="token assign-left variable">major</span><span class="token operator">=</span><span class="token string">&quot;1&quot;</span> <span class="token assign-left variable">minor</span><span class="token operator">=</span><span class="token string">&quot;27&quot;</span> <span class="token assign-left variable">git</span><span class="token operator">=</span><span class="token string">&quot;v1.27.3&quot;</span> <span class="token assign-left variable">state</span><span class="token operator">=</span><span class="token string">&quot;clean&quot;</span> <span class="token assign-left variable">commit</span><span class="token operator">=</span><span class="token string">&quot;25b4e43193bcda6c7328a6d147b1fb73a33f1598&quot;</span> <span class="token assign-left variable">platform</span><span class="token operator">=</span><span class="token string">&quot;linux/arm64&quot;</span>\nI0822 06:26:30.520820      <span class="token number">10</span> main.go:104<span class="token punctuation">]</span> <span class="token string">&quot;SSL fake certificate created&quot;</span> <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">&quot;/etc/ingress-controller/ssl/default-fake-certificate.pem&quot;</span>\nI0822 06:26:30.531350      <span class="token number">10</span> ssl.go:533<span class="token punctuation">]</span> <span class="token string">&quot;loading tls certificate&quot;</span> <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/cert&quot;</span> <span class="token assign-left variable">key</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/key&quot;</span>\nI0822 06:26:30.543711      <span class="token number">10</span> nginx.go:261<span class="token punctuation">]</span> <span class="token string">&quot;Starting NGINX Ingress controller&quot;</span>\nI0822 06:26:30.551968      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;ConfigMap&quot;</span>, Namespace:<span class="token string">&quot;ingress-nginx&quot;</span>, Name:<span class="token string">&quot;ingress-nginx-controller&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;c019e1aa-4bc2-42f9-a049-c1a714404030&quot;</span>, APIVersion:<span class="token string">&quot;v1&quot;</span>, ResourceVersion:<span class="token string">&quot;134801&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;CREATE&#39;</span> ConfigMap ingress-nginx/ingress-nginx-controller\nI0822 06:26:31.745338      <span class="token number">10</span> nginx.go:304<span class="token punctuation">]</span> <span class="token string">&quot;Starting NGINX process&quot;</span>\nI0822 06:26:31.745585      <span class="token number">10</span> leaderelection.go:248<span class="token punctuation">]</span> attempting to acquire leader lease ingress-nginx/ingress-nginx-leader<span class="token punctuation">..</span>.\nI0822 06:26:31.746220      <span class="token number">10</span> nginx.go:324<span class="token punctuation">]</span> <span class="token string">&quot;Starting validation webhook&quot;</span> <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token string">&quot;:8443&quot;</span> <span class="token assign-left variable">certPath</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/cert&quot;</span> <span class="token assign-left variable">keyPath</span><span class="token operator">=</span><span class="token string">&quot;/usr/local/certificates/key&quot;</span>\nI0822 06:26:31.746577      <span class="token number">10</span> controller.go:190<span class="token punctuation">]</span> <span class="token string">&quot;Configuration changes detected, backend reload required&quot;</span>\nI0822 06:26:31.751580      <span class="token number">10</span> status.go:84<span class="token punctuation">]</span> <span class="token string">&quot;New leader elected&quot;</span> <span class="token assign-left variable">identity</span><span class="token operator">=</span><span class="token string">&quot;ingress-nginx-controller-5fcb5746fc-4ppzf&quot;</span>\nI0822 06:26:31.827000      <span class="token number">10</span> controller.go:207<span class="token punctuation">]</span> <span class="token string">&quot;Backend successfully reloaded&quot;</span>\nI0822 06:26:31.831564      <span class="token number">10</span> controller.go:218<span class="token punctuation">]</span> <span class="token string">&quot;Initial sync, sleeping for 1 second&quot;</span>\nI0822 06:26:31.831562      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Pod&quot;</span>, Namespace:<span class="token string">&quot;ingress-nginx&quot;</span>, Name:<span class="token string">&quot;ingress-nginx-controller-5db5867dcf-v9pfv&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;5572da28-300b-42c4-9faf-414b5211e65e&quot;</span>, APIVersion:<span class="token string">&quot;v1&quot;</span>, ResourceVersion:<span class="token string">&quot;134833&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;RELOAD&#39;</span> NGINX reload triggered due to a change <span class="token keyword">in</span> configuration\nI0822 06:27:08.891616      <span class="token number">10</span> leaderelection.go:258<span class="token punctuation">]</span> successfully acquired lease ingress-nginx/ingress-nginx-leader\nI0822 06:27:08.891679      <span class="token number">10</span> status.go:84<span class="token punctuation">]</span> <span class="token string">&quot;New leader elected&quot;</span> <span class="token assign-left variable">identity</span><span class="token operator">=</span><span class="token string">&quot;ingress-nginx-controller-5db5867dcf-v9pfv&quot;</span>\nW0822 07:54:01.251978      <span class="token number">10</span> controller.go:328<span class="token punctuation">]</span> ignoring ingress demo-redirect <span class="token keyword">in</span> default based on annotation <span class="token builtin class-name">:</span> no object matching key <span class="token string">&quot;nginx&quot;</span> <span class="token keyword">in</span> <span class="token builtin class-name">local</span> store\nI0822 07:54:01.252103      <span class="token number">10</span> main.go:110<span class="token punctuation">]</span> <span class="token string">&quot;successfully validated configuration, accepting&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo-redirect&quot;</span>\nI0822 07:54:01.255287      <span class="token number">10</span> store.go:428<span class="token punctuation">]</span> <span class="token string">&quot;Ignoring ingress because of error while validating ingress class&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo-redirect&quot;</span> <span class="token assign-left variable">error</span><span class="token operator">=</span><span class="token string">&quot;no object matching key <span class="token entity" title="\\&quot;">\\&quot;</span>nginx<span class="token entity" title="\\&quot;">\\&quot;</span> in local store&quot;</span>\nI0822 07:54:14.491144      <span class="token number">10</span> store.go:398<span class="token punctuation">]</span> <span class="token string">&quot;Ignoring ingress because of error while validating ingress class&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo-redirect&quot;</span> <span class="token assign-left variable">error</span><span class="token operator">=</span><span class="token string">&quot;no object matching key <span class="token entity" title="\\&quot;">\\&quot;</span>nginx<span class="token entity" title="\\&quot;">\\&quot;</span> in local store&quot;</span>\nI0822 07:59:03.354862      <span class="token number">10</span> admission.go:149<span class="token punctuation">]</span> processed ingress via admission controller <span class="token punctuation">{</span>testedIngressLength:1 testedIngressTime:0.06s renderingIngressLength:1 renderingIngressTime:0.001s admissionTime:25.5kBs testedConfigurationSize:0.061<span class="token punctuation">}</span>\nI0822 07:59:03.354910      <span class="token number">10</span> main.go:110<span class="token punctuation">]</span> <span class="token string">&quot;successfully validated configuration, accepting&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo&quot;</span>\nI0822 07:59:03.360144      <span class="token number">10</span> store.go:432<span class="token punctuation">]</span> <span class="token string">&quot;Found valid IngressClass&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/demo&quot;</span> <span class="token assign-left variable">ingressclass</span><span class="token operator">=</span><span class="token string">&quot;int-ingress-nginx&quot;</span>\nI0822 07:59:03.360620      <span class="token number">10</span> controller.go:190<span class="token punctuation">]</span> <span class="token string">&quot;Configuration changes detected, backend reload required&quot;</span>\nI0822 07:59:03.362848      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Ingress&quot;</span>, Namespace:<span class="token string">&quot;default&quot;</span>, Name:<span class="token string">&quot;demo&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;64bbeb49-e705-423c-9f86-1fcbf066f6ce&quot;</span>, APIVersion:<span class="token string">&quot;networking.k8s.io/v1&quot;</span>, ResourceVersion:<span class="token string">&quot;143749&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;Sync&#39;</span> Scheduled <span class="token keyword">for</span> <span class="token function">sync</span>\nI0822 07:59:03.404657      <span class="token number">10</span> controller.go:207<span class="token punctuation">]</span> <span class="token string">&quot;Backend successfully reloaded&quot;</span>\nI0822 07:59:03.404826      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Pod&quot;</span>, Namespace:<span class="token string">&quot;ingress-nginx&quot;</span>, Name:<span class="token string">&quot;ingress-nginx-controller-5db5867dcf-v9pfv&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;5572da28-300b-42c4-9faf-414b5211e65e&quot;</span>, APIVersion:<span class="token string">&quot;v1&quot;</span>, ResourceVersion:<span class="token string">&quot;134833&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;RELOAD&#39;</span> NGINX reload triggered due to a change <span class="token keyword">in</span> configuration\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:01:56 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">404</span> <span class="token number">146</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">80</span> <span class="token number">0.002</span> <span class="token punctuation">[</span>upstream-default-backend<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">127.0</span>.0.1:8181 <span class="token number">146</span> <span class="token number">0.002</span> <span class="token number">404</span> eba5cdeb999b4cac9a00142e599cbb1c\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:01:59 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /info HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">35</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">84</span> <span class="token number">0.043</span> <span class="token punctuation">[</span>default-demo-svc-8080<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">10.244</span>.0.27:8080 <span class="token number">35</span> <span class="token number">0.044</span> <span class="token number">200</span> 6ffcb6dd13f1b157b6b12e1ec8bd2336\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:03:39 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /info HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">35</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">84</span> <span class="token number">0.007</span> <span class="token punctuation">[</span>default-demo-svc-8080<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">10.244</span>.0.27:8080 <span class="token number">35</span> <span class="token number">0.007</span> <span class="token number">200</span> 6846c357020f3beb6245c2d42f7d3c8c\nI0822 08:10:19.216812      <span class="token number">10</span> admission.go:149<span class="token punctuation">]</span> processed ingress via admission controller <span class="token punctuation">{</span>testedIngressLength:2 testedIngressTime:0.067s renderingIngressLength:2 renderingIngressTime:0.001s admissionTime:32.8kBs testedConfigurationSize:0.068<span class="token punctuation">}</span>\nI0822 08:10:19.216851      <span class="token number">10</span> main.go:110<span class="token punctuation">]</span> <span class="token string">&quot;successfully validated configuration, accepting&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/auth&quot;</span>\nI0822 08:10:19.224537      <span class="token number">10</span> store.go:432<span class="token punctuation">]</span> <span class="token string">&quot;Found valid IngressClass&quot;</span> <span class="token assign-left variable">ingress</span><span class="token operator">=</span><span class="token string">&quot;default/auth&quot;</span> <span class="token assign-left variable">ingressclass</span><span class="token operator">=</span><span class="token string">&quot;ingress-nginx&quot;</span>\nI0822 08:10:19.224973      <span class="token number">10</span> controller.go:190<span class="token punctuation">]</span> <span class="token string">&quot;Configuration changes detected, backend reload required&quot;</span>\nI0822 08:10:19.225003      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Ingress&quot;</span>, Namespace:<span class="token string">&quot;default&quot;</span>, Name:<span class="token string">&quot;auth&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;dfd1450a-a1c6-45fa-9f77-d74ac29764a9&quot;</span>, APIVersion:<span class="token string">&quot;networking.k8s.io/v1&quot;</span>, ResourceVersion:<span class="token string">&quot;144811&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;Sync&#39;</span> Scheduled <span class="token keyword">for</span> <span class="token function">sync</span>\nI0822 08:10:19.271423      <span class="token number">10</span> controller.go:207<span class="token punctuation">]</span> <span class="token string">&quot;Backend successfully reloaded&quot;</span>\nI0822 08:10:19.271788      <span class="token number">10</span> event.go:285<span class="token punctuation">]</span> Event<span class="token punctuation">(</span>v1.ObjectReference<span class="token punctuation">{</span>Kind:<span class="token string">&quot;Pod&quot;</span>, Namespace:<span class="token string">&quot;ingress-nginx&quot;</span>, Name:<span class="token string">&quot;ingress-nginx-controller-5db5867dcf-v9pfv&quot;</span>, <span class="token environment constant">UID</span><span class="token builtin class-name">:</span><span class="token string">&quot;5572da28-300b-42c4-9faf-414b5211e65e&quot;</span>, APIVersion:<span class="token string">&quot;v1&quot;</span>, ResourceVersion:<span class="token string">&quot;134833&quot;</span>, FieldPath:<span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>: type: <span class="token string">&#39;Normal&#39;</span> reason: <span class="token string">&#39;RELOAD&#39;</span> NGINX reload triggered due to a change <span class="token keyword">in</span> configuration\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:11:11 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /login HTTP/1.1&quot;</span> <span class="token number">404</span> <span class="token number">18</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">85</span> <span class="token number">0.036</span> <span class="token punctuation">[</span>default-auth-svc-8080<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">10.244</span>.0.26:8080 <span class="token number">18</span> <span class="token number">0.036</span> <span class="token number">404</span> aa8a7aa2bb41c704a5426bb851e967e6\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:11:14 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /login HTTP/1.1&quot;</span> <span class="token number">404</span> <span class="token number">18</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">85</span> <span class="token number">0.005</span> <span class="token punctuation">[</span>default-auth-svc-8080<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">10.244</span>.0.26:8080 <span class="token number">18</span> <span class="token number">0.006</span> <span class="token number">404</span> 05a5c56c610ae2e3c11d8a1fe8ed7778\n<span class="token number">127.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">22</span>/Aug/2023:08:11:15 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /login HTTP/1.1&quot;</span> <span class="token number">404</span> <span class="token number">18</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;curl/7.88.1&quot;</span> <span class="token number">85</span> <span class="token number">0.004</span> <span class="token punctuation">[</span>default-auth-svc-8080<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token number">10.244</span>.0.26:8080 <span class="token number">18</span> <span class="token number">0.004</span> <span class="token number">404</span> 2787d38a23c042e5145f62310c0be4b0\n\n<span class="token comment"># 可以看出是否流量进入的说明验证成功了</span>\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>本文介绍了Kubernetes集群内部署多个Ingress控制器的应用场景，并通过实际案例的方式讲解，下一章将讲解Ingress更多企业级实战，请敬请期待！</p>', 36);
const _hoisted_37 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache) {
  return openBlock(), createElementBlock("div", null, _hoisted_37);
}
const bushuduogeIngresskongzhiqi_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "bushuduogeIngresskongzhiqi.html.vue"]]);
export {
  bushuduogeIngresskongzhiqi_html as default
};
