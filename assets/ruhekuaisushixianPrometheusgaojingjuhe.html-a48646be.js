import { _ as _export_sfc, r as resolveComponent, o as openBlock, c as createElementBlock, b as createBaseVNode, d as createTextVNode, e as createVNode, a as createStaticVNode } from "./app-d515af8b.js";
const _sfc_main = {};
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h2 id="上篇回顾" tabindex="-1"><a class="header-anchor" href="#上篇回顾" aria-hidden="true">#</a> 上篇回顾</h2><p>上篇文章我们主要对告警排班进行了阐述，具体实现思路可以添加下方二维码一起来聊一聊。当然我们针对告警排班并没有做到通用，针对这种情况后期会输出一个可通用demo。当我们在使用告警时经常会遇到告警洪流的问题，所以我们针对此类问题特此做一了个告警聚合来尽可能的避免改问题的出现</p><h2 id="告警聚合" tabindex="-1"><a class="header-anchor" href="#告警聚合" aria-hidden="true">#</a> 告警聚合</h2><p>我们看一下GPT针对告警聚合给出的解释</p><p>在 Prometheus 中，告警聚合是指将多个相关的告警事件合并为单个聚合告警。当存在大量具有相同或相似问题的告警时，告警聚合可以帮助减少噪声，并提供更清晰、更有可读性的告警信息。</p><p>通过告警聚合，可以将多个相关的告警事件合并为一个聚合告警，并在其中提供概要和摘要信息。这样，当出现大规模故障或问题时，可以避免大量重复的单独告警，而是以更简洁的方式提供关键信息。</p><p>告警聚合通常基于共享标签（例如，相同的实例、相同的任务等）来确定哪些告警应该被聚合。在 Prometheus 的配置文件中，可以使用 <code>group_by</code> 关键字来定义告警聚合规则。</p><h2 id="案例介绍" tabindex="-1"><a class="header-anchor" href="#案例介绍" aria-hidden="true">#</a> 案例介绍</h2><p>基于告警认领功能实现代码的基础上进行稍加修改(代码可以添加下方二维码获取)，依旧使用<code>gin</code>、<code>gorm</code>是实现针对告警名称的聚合，结合<code>template</code>简单展示告警详情列表</p><h2 id="环境概述" tabindex="-1"><a class="header-anchor" href="#环境概述" aria-hidden="true">#</a> 环境概述</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># kubectl get nodes </span>\nNAME               STATUS   ROLES                  AGE   VERSION\nk8s-master-50.57   Ready    control-plane,master   96d   v1.20.5\nk8s-node-50.58     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 96d   v1.20.5\nk8s-node-50.59     Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>                 96d   v1.20.5\n\n<span class="token comment"># kubectl get pod -n monitoring </span>\nNAME                                  READY   STATUS    RESTARTS   AGE\nalertmanager-main-0                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nalertmanager-main-1                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nalertmanager-main-2                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nblackbox-exporter-55c457d5fb-5m7ql    <span class="token number">3</span>/3     Running   <span class="token number">0</span>          8d\ngrafana-9df57cdc4-gpzsq               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nkube-state-metrics-56dbb74497-gpkn9   <span class="token number">3</span>/3     Running   <span class="token number">0</span>          8d\nnode-exporter-4wl6d                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nnode-exporter-b4595                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nnode-exporter-g4l99                   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\nprometheus-adapter-59df95d9f5-tnt4w   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nprometheus-adapter-59df95d9f5-xhz5v   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8d\nprometheus-k8s-0                      <span class="token number">2</span>/2     Running   <span class="token number">1</span>          8d\nprometheus-k8s-1                      <span class="token number">2</span>/2     Running   <span class="token number">1</span>          10m\nprometheus-operator-c46b8b7c9-mg9cv   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8d\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>golang版本：1.17.10</p></li><li><p>gin版本：1.9.0</p></li><li><p>gorm版本：1.25.1</p></li></ul><h2 id="快速开始" tabindex="-1"><a class="header-anchor" href="#快速开始" aria-hidden="true">#</a> 快速开始</h2><ol><li>钉钉机器人创建</li></ol>', 14);
const _hoisted_15 = {
  href: "https://mp.weixin.qq.com/s/EZBm9NyYNhOs0isJm0kXOw",
  target: "_blank",
  rel: "noopener noreferrer"
};
const _hoisted_16 = /* @__PURE__ */ createStaticVNode('<ol start="2"><li>创建template模板</li></ol><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>告警详情<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tfhover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tftable<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n        {{ if gt (len .slice) 0 }}\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token punctuation">&gt;</span></span>告警序号<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>告警名称<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>告警实例<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>告警时间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>告警详情<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>\n        {{ range $index, $value := .slice }}\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ $value.ID }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ $value.AlertName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ $value.Instance }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ $value.CreatedAt }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ $value.AlertInfo }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>\n        {{ end }}\n        {{ else }}\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">colspan</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>No data available<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>\n        {{ end }}\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">table.tftable</span> <span class="token punctuation">{</span><span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#333333<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">border-width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span><span class="token property">border-color</span><span class="token punctuation">:</span> #729ea5<span class="token punctuation">;</span><span class="token property">border-collapse</span><span class="token punctuation">:</span> collapse<span class="token punctuation">;</span><span class="token punctuation">}</span>\n    <span class="token selector">table.tftable th</span> <span class="token punctuation">{</span><span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span>#acc8cc<span class="token punctuation">;</span><span class="token property">border-width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span><span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span><span class="token property">border-color</span><span class="token punctuation">:</span> #729ea5<span class="token punctuation">;</span><span class="token property">text-align</span><span class="token punctuation">:</span>left<span class="token punctuation">;</span><span class="token punctuation">}</span>\n    <span class="token selector">table.tftable tr</span> <span class="token punctuation">{</span><span class="token property">background-color</span><span class="token punctuation">:</span>#d4e3e5<span class="token punctuation">;</span><span class="token punctuation">}</span>\n    <span class="token selector">table.tftable td</span> <span class="token punctuation">{</span><span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span><span class="token property">border-width</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span><span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span><span class="token property">border-color</span><span class="token punctuation">:</span> #729ea5<span class="token punctuation">;</span><span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n    window<span class="token punctuation">.</span><span class="token function-variable function">onload</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n        <span class="token keyword">var</span> tfrow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tfhover&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rows<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> tbRow<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>tfrow<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            tbRow<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;tfhover&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>\n            tbRow<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onmouseover</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">&#39;#ffffff&#39;</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">;</span>\n            tbRow<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onmouseout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">&#39;#d4e3e5&#39;</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>这里只是简单的展示了告警详情，小伙伴也可以自定义该template</p></blockquote><h3 id="核心代码" tabindex="-1"><a class="header-anchor" href="#核心代码" aria-hidden="true">#</a> 核心代码</h3><ol><li>聚合实例</li></ol><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>pa <span class="token operator">*</span>prometheusAlert<span class="token punctuation">)</span> <span class="token function">AddPrometheusAlert</span><span class="token punctuation">(</span>paMsg model<span class="token punctuation">.</span>Alerts<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n	<span class="token keyword">var</span> alertInfo model<span class="token punctuation">.</span>PrometheusAlert\n	<span class="token keyword">var</span> <span class="token punctuation">(</span>\n		uids       <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>\n		instance   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>\n		claimUsers <span class="token builtin">string</span>\n		title      <span class="token builtin">string</span>\n	<span class="token punctuation">)</span>\n	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> alert <span class="token operator">:=</span> <span class="token keyword">range</span> paMsg<span class="token punctuation">.</span>Alerts <span class="token punctuation">{</span>\n		alertInfo<span class="token punctuation">.</span>UID <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">EntryMd5</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>AlertName<span class="token punctuation">,</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Pod<span class="token punctuation">,</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Namespace<span class="token punctuation">,</span>\n			alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Severity<span class="token punctuation">,</span> alert<span class="token punctuation">.</span>StartsAt<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n		alertInfo<span class="token punctuation">.</span>AlertName <span class="token operator">=</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>AlertName\n		alertInfo<span class="token punctuation">.</span>Instance <span class="token operator">=</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Instance\n		alertInfo<span class="token punctuation">.</span>Server <span class="token operator">=</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Server\n		alertInfo<span class="token punctuation">.</span>Severity <span class="token operator">=</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Severity\n		alertInfo<span class="token punctuation">.</span>AlertInfo <span class="token operator">=</span> alert<span class="token punctuation">.</span>Annotations<span class="token punctuation">.</span>Description\n		alertInfo<span class="token punctuation">.</span>Pod <span class="token operator">=</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Pod\n		alertInfo<span class="token punctuation">.</span>Pod <span class="token operator">=</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Container\n		alertInfo<span class="token punctuation">.</span>Namespace <span class="token operator">=</span> alert<span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>Namespace\n		<span class="token boolean">_</span><span class="token punctuation">,</span> uid <span class="token operator">:=</span> db<span class="token punctuation">.</span>PrometheusAlert<span class="token punctuation">.</span><span class="token function">AddPrometheusAlert</span><span class="token punctuation">(</span>alertInfo<span class="token punctuation">)</span>\n		uids <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>uids<span class="token punctuation">,</span> uid<span class="token punctuation">)</span>\n		alertMsg<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span>PrometheusAlert<span class="token punctuation">.</span><span class="token function">SelectPrometheusAlert</span><span class="token punctuation">(</span>alertInfo<span class="token punctuation">.</span>UID<span class="token punctuation">)</span>\n		instance <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> alertMsg<span class="token punctuation">.</span>Instance<span class="token punctuation">)</span>\n	<span class="token punctuation">}</span>\n	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token punctuation">{</span>\n		instance <span class="token operator">=</span> instance<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>\n		instance <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token string">&quot;\\n\\n&lt;font color=\\&quot;#02b340\\&quot;&gt;实例过多请点击详情查看&lt;/font&gt;&quot;</span><span class="token punctuation">)</span>\n	<span class="token punctuation">}</span>\n	data<span class="token punctuation">,</span> title <span class="token operator">:=</span> template<span class="token punctuation">.</span><span class="token function">DingGroupAlert</span><span class="token punctuation">(</span>paMsg<span class="token punctuation">.</span>Alerts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Labels<span class="token punctuation">.</span>AlertName<span class="token punctuation">,</span> paMsg<span class="token punctuation">.</span>Alerts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Annotations<span class="token punctuation">.</span>Description<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n	data <span class="token operator">+=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;### [查看详情](dingtalk://dingtalkclient/page/link?url=%s&amp;pc_slide=true&amp;title=%s)&quot;</span><span class="token punctuation">,</span>\n		utils<span class="token punctuation">.</span><span class="token function">URLEncode</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;groupAlert.url&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;?uid=&quot;</span><span class="token operator">+</span>strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>uids<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>\n	<span class="token boolean">_</span> <span class="token operator">=</span> DingSend<span class="token punctuation">.</span><span class="token function">SendDing</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;dingTalk.hook&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> title<span class="token punctuation">,</span> utils<span class="token punctuation">.</span><span class="token function">StringToSlice</span><span class="token punctuation">(</span>claimUsers<span class="token punctuation">)</span><span class="token punctuation">)</span>\n	<span class="token keyword">return</span> <span class="token boolean">nil</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>告警列表</li></ol><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>pa <span class="token operator">*</span>prometheusAlert<span class="token punctuation">)</span> <span class="token function">SelectPrometheusAlertList</span><span class="token punctuation">(</span>uids <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>data <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>model<span class="token punctuation">.</span>PrometheusAlert<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> uid <span class="token operator">:=</span> <span class="token keyword">range</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>uids<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n		dataOne<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span>PrometheusAlert<span class="token punctuation">.</span><span class="token function">SelectPrometheusAlert</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span>\n		data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> dataOne<span class="token punctuation">)</span>\n	<span class="token punctuation">}</span>\n	<span class="token keyword">return</span> data<span class="token punctuation">,</span> <span class="token boolean">nil</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>加载template</li></ol><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>pa <span class="token operator">*</span>prometheusAlert<span class="token punctuation">)</span> <span class="token function">PrometheusAlertList</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n	uids<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">GetQuery</span><span class="token punctuation">(</span><span class="token string">&quot;uid&quot;</span><span class="token punctuation">)</span>\n	slice<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> service<span class="token punctuation">.</span>PrometheusAlert<span class="token punctuation">.</span><span class="token function">SelectPrometheusAlertList</span><span class="token punctuation">(</span>uids<span class="token punctuation">)</span>\n	ctx<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>\n		<span class="token string">&quot;slice&quot;</span><span class="token punctuation">:</span> slice<span class="token punctuation">,</span>\n	<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="触发告警" tabindex="-1"><a class="header-anchor" href="#触发告警" aria-hidden="true">#</a> 触发告警</h3><p><img src="https://img.kubesre.com/kubesre/20230911/1.png" alt=""></p><blockquote><p>告警信息的展示仅仅展示了部分内容，可以按照各自的需求进行展示</p></blockquote><h3 id="查看详情" tabindex="-1"><a class="header-anchor" href="#查看详情" aria-hidden="true">#</a> 查看详情</h3><p><img src="https://img.kubesre.com/kubesre/20230911/2.png" alt=""></p><blockquote><p>告警详情仅仅展示了部分内容，可以根据数据库字段按需展示。这里也可以跟告警认领功能结合使用。</p></blockquote><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>告警聚合到此就结束了，这只是在工作中这么使用的，如有误的地方还希望与大佬一起交流一下，当然代码可以添加下方二维码领取。</p>', 18);
function _sfc_render(_ctx, _cache) {
  const _component_ExternalLinkIcon = resolveComponent("ExternalLinkIcon");
  return openBlock(), createElementBlock("div", null, [
    _hoisted_1,
    createBaseVNode("p", null, [
      createTextVNode("这里就不做过多的说明了，"),
      createBaseVNode("a", _hoisted_15, [
        createTextVNode("详细请看告警认领功能实现章节"),
        createVNode(_component_ExternalLinkIcon)
      ])
    ]),
    _hoisted_16
  ]);
}
const ruhekuaisushixianPrometheusgaojingjuhe_html = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render], ["__file", "ruhekuaisushixianPrometheusgaojingjuhe.html.vue"]]);
export {
  ruhekuaisushixianPrometheusgaojingjuhe_html as default
};
